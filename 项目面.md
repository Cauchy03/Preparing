## ç§»åŠ¨ç«¯é€‚é…

```
é¦–å…ˆæ˜¯è¿™ä¸ªåª’ä½“æŸ¥è¯¢ï¼Œä¼šæ ¹æ®ä¸åŒçš„å±å¹•å°ºå¯¸å¤§å°æ˜¾ç¤ºä¸åŒcssæ ·å¼ï¼Œä½†æ²¡å¤šä¸€ä¸ªå±å¹•å°ºå¯¸ï¼Œå°±ä¼šå¤šä¸€ä¸ª@mediaæŸ¥è¯¢å—ï¼Œä¸»è¦ç”¨äºä¸€äº›æç«¯æƒ…å†µï¼Œæ¯”å¦‚ipadå¤§å±æˆ–ä¸€äº›ç®€å•çš„é€‚é…ã€‚
ç„¶åæ˜¯è¿™ä¸ªremé€‚é…ï¼Œremæ˜¯ä¸€ä¸ªç›¸å¯¹å•ä½ï¼Œç›¸å¯¹äºæ ¹å…ƒç´ çš„font-sizeçš„å€¼ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ­é…flexible.jsä¸€ä¸ªé˜¿é‡Œæ—©æœŸçš„å¼€æºç§»åŠ¨é€‚é…åº“ï¼Œå°±æ˜¯é‡‡ç”¨remé€šè¿‡jsæ¨¡æ‹Ÿvwçš„ç‰¹æ€§è¿›è¡Œé€‚é…ï¼Œå› ä¸ºvwå’Œvhå¾ˆå¤šæµè§ˆå™¨å¹¶ä¸å…¼å®¹ï¼Œä½†æ˜¯remå’Œæ ¹å…ƒç´ font-sizeçš„å€¼å¼ºè€¦åˆï¼Œç³»ç»Ÿå­—ä½“å¤§å°æ”¾å¤§æˆ–ç¼©å°çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´å¸ƒå±€é”™ä¹±ã€‚
ç„¶åæ˜¯vw/vhé€‚é…ï¼Œç›¸å¯¹å•ä½ï¼Œæ ¹æ®å¯è§†åŒ–çª—å£çš„ç™¾åˆ†å æ¯”ï¼Œä½†ä¸%åˆæœ‰æ‰€åŒºåˆ«ï¼Œ%ç›¸å¯¹äºçˆ¶å…ƒç´ ï¼Œè€Œvw/vhç›¸å¯¹äºå¯è§†åŒ–çª—å£ï¼Œä¸»è¦å°±æ˜¯å…¼å®¹æ€§çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ¡ˆå¯ä»¥é€šè¿‡ postcss-px-to-viewport æ’ä»¶ï¼Œå°†pxè‡ªåŠ¨è½¬ä¸ºvw/vhï¼Œä¸€å¼€å§‹ç›´æ¥ä½¿ç”¨çš„è¯å½±å“å¼€å‘æ•ˆç‡ï¼ˆéœ€è¦æ‰‹åŠ¨è®¡ç®—å°† px è½¬æ¢ä¸º vwï¼‰ä¸”ä¸åˆ©äºåç»­ä»£ç ç»´æŠ¤ï¼ˆcss ä»£ç ä¸­ä¸€å † vw å•ä½ï¼Œä¸å¦‚ px çœ‹çš„ç›´è§‚ï¼‰
```

## RBACæƒé™ç®¡ç†

[ä¸‡å­—é•¿æ–‡~vue+express+mysqlå¸¦ä½ å½»åº•ææ‡‚é¡¹ç›®ä¸­çš„æƒé™æ§åˆ¶ï¼ˆé™„æ‰€æœ‰æºç ï¼‰ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7188808031801442363#heading-0)

```
RBACæ„ä¸ºåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼Œæ˜¯ä¸€ä¸ªæƒé™è®¾è®¡æ€æƒ³ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ®ä¸åŒçš„ç”¨æˆ·è§’è‰²ï¼Œæœ‰ä¸åŒçš„æƒé™æ§åˆ¶ã€‚

ç»™å‘˜å·¥é…ç½®è§’è‰² ï¼ˆä¸€ä¸ªå‘˜å·¥å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼‰
ç»™è§’è‰²é…ç½®æƒé™ç‚¹ ï¼ˆä¸€ä¸ªè§’è‰²å¯ä»¥æœ‰å¤šä¸ªæƒé™ç‚¹ï¼‰
å‘˜å·¥åªè¦æœ‰äº†è§’è‰²ä¹‹åï¼Œå°±è‡ªåŠ¨æ‹¥æœ‰äº†è§’è‰²ç»‘å®šçš„æ‰€æœ‰æƒé™ç‚¹
```

æ ¹æ®æƒé™è®¾è®¡æ€æƒ³å¯¹åº”ä¸šåŠ¡æ¨¡å—

- å‘˜å·¥ç®¡ç†
- è§’è‰²ç®¡ç†
- æƒé™ç‚¹ç®¡ç†ï¼ˆå®ƒæ˜¯æ²¡æœ‰è°ƒæ•´çš„ä½™åœ°çš„ï¼šå®ƒä¼šä¸¥æ ¼ä¸å½“å‰ç³»ç»Ÿçš„åŠŸèƒ½å¯¹åº”ï¼ï¼‰

### èœå•æƒé™ç®¡ç†

```
å°†è·¯ç”±åˆ†ä¸ºå¸¸é‡è·¯ç”±ä¹Ÿå°±æ˜¯å…±äº«è·¯ç”±ï¼Œå¼‚æ­¥è·¯ç”±æ¶‰åŠæƒé™çš„è·¯ç”±ï¼Œåœ¨metaæ ‡ç­¾ä¸­è®¾ç½®ä¸€ä¸ªrouteIDï¼Œæ ¹æ®è¿”å›å›æ¥çš„è·¯ç”±è¡¨è¿›è¡Œä¸€ä¸ªåŒ¹é…æŸ¥è¯¢ï¼Œæœ€åå°†å¸¸é‡è·¯ç”±å’Œå¼‚æ­¥è·¯ç”±è¿›è¡Œä¸€ä¸ªåˆå¹¶ï¼Œåœ¨é€šè¿‡router.addroutes()æ·»åŠ æœ€ç»ˆçš„è·¯ç”±ã€‚å°†æœ€ç»ˆçš„è·¯ç”±å­˜åœ¨vuexä¸­ï¼Œç„¶ååŠ¨æ€æ¸²æŸ“å·¦ä¾§çš„èœå•
```

```js
// è®¡ç®—å¼‚æ­¥è·¯ç”±å±æ€§
function computeRoutes(asyncRoutes, routes) {
    return asyncRoutes.filter(item => {
        // åˆ¤æ–­ä¸€çº§è·¯ç”±
        if (routes.indexOf(item.name) !== -1) {
            // é€’å½’ éå†å­è·¯ç”±
            if (item.children && item.children.length) {
                item.children = computeRoutes(item.children, routes)
            }
            return true
        }
    })
}
```

```js
state.resultAsyncRoutes = asyncRoutes
// åªåŒ…å«å¼‚æ­¥è·¯ç”±ï¼Œè¿˜éœ€åˆå¹¶å¸¸é‡è·¯ç”±å’Œä»»æ„è·¯ç”±
state.resultRoutes = constantRoutes.concat(state.resultAsyncRoutes, anyRoutes)
// routeræ·»åŠ è·¯ç”±
router.addRoutes(state.resultRoutes)
```

### é¡µé¢ä¸­æ§åˆ¶æŒ‰é’®æƒé™

```js
// è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ v-allow
// æ³¨å†Œä¸€ä¸ªå…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ `v-allow`
Vue.directive('allow', {
    inserted: function(el, binding) {
        // ä»vuexä¸­å–å‡ºpoints,
        const points = store.state.user.userInfo.roles.points
        // å¦‚æœpointsæœ‰binding.valueåˆ™æ˜¾ç¤º
        if (points.includes(binding.value)) {
            // console.log('åˆ¤æ–­è¿™ä¸ªå…ƒç´ æ˜¯å¦ä¼šæ˜¾ç¤º', el, binding.value)
        } else {
            el.parentNode.removeChild(el)
            // el.style.display = 'none'
        }
    }
})
```

```html
<el-button
           v-allow="'import_employee'"
           type="warning"
           size="small"
           @click="$router.push('/import')"
           >å¯¼å…¥excel</el-button>
```

### ä¸€äº›BUG

#### åˆ·æ–°é¡µé¢æ—¶å‡ºç°404

åŠ¨æ€æ·»åŠ è·¯ç”±å 404çš„ä½ç½®ä¸æ˜¯è·¯ç”±çš„æœ«å°¾äº† æŠŠ404é¡µé¢æ”¹åˆ°æœ€æœ«å°¾

ä»route/index.jsä¸­çš„é™æ€è·¯ç”±ä¸­åˆ é™¤`path:'*'`è¿™ä¸€é¡¹

```js
// ä¸éœ€è¦ç‰¹æ®Šçš„æƒé™æ§åˆ¶å°±å¯ä»¥è®¿é—®çš„é¡µé¢
export const constantRoutes = [
    {
        path: '/login',
        component: () => import('@/views/login/index'),
        hidden: true
    },
    // 404 page must be placed at the end !!!
    { path: '*', redirect: '/404', hidden: true }
]
```

åœ¨è·¯ç”±å®ˆå«ä¸­æœ€åæ·»åŠ åˆ°è¿‡æ»¤çš„è·¯ç”±æ•°ç»„ä¸­

```js
if (!store.getters.userId) {
    // ....
    const filterRoutes = asyncRoutes.filter(route => {
        const routeName = route.children[0].name
        return menus.includes(routeName)
    })

    // ä¸€å®šè¦åœ¨è¿›å…¥ä¸»é¡µä¹‹å‰å»è·å–ç”¨æˆ·ä¿¡æ¯
    // æŠŠ404åŠ åˆ°æœ€åä¸€æ¡
    filterRoutes.push( // 404 page must be placed at the end !!!
        { path: '*', redirect: '/404', hidden: true })

    // addRoutesç”¨æ¥åŠ¨æ€æ·»åŠ è·¯ç”±é…ç½®
    // åªæœ‰åœ¨è¿™é‡Œè®¾ç½®äº†è¡¥å……äº†è·¯ç”±é…ç½®ï¼Œæ‰å¯èƒ½å»è®¿é—®é¡µé¢
    // å®ƒä»¬ä¸ä¼šå‡ºç°å·¦ä¾§
    router.addRoutes(filterRoutes)
    // ...
} 
```

#### å¯¹äºaddRoutesæ·»åŠ çš„è·¯ç”±ï¼Œåœ¨åˆ·æ–°æ—¶ä¼šç™½å±

åœ¨`addRoutes()`ä¹‹åç¬¬ä¸€æ¬¡è®¿é—®è¢«æ·»åŠ çš„è·¯ç”±ä¼šç™½å±ï¼Œè¿™æ˜¯å› ä¸ºåˆšåˆš`addRoutes()`å°±ç«‹åˆ»è®¿é—®è¢«æ·»åŠ çš„è·¯ç”±ï¼Œç„¶è€Œæ­¤æ—¶`addRoutes()`æ²¡æœ‰æ‰§è¡Œç»“æŸï¼Œå› è€Œæ‰¾ä¸åˆ°åˆšåˆšè¢«æ·»åŠ çš„è·¯ç”±å¯¼è‡´ç™½å±ã€‚å› æ­¤éœ€è¦ä»æ–°è®¿é—®ä¸€æ¬¡è·¯ç”±æ‰è¡Œã€‚

```js
if (!store.getters.userId) {
    // çœç•¥å…¶ä»–...

    // è§£å†³åˆ·æ–°å‡ºç°çš„ç™½å±bug
    next({
        ...to, // next({ ...to })çš„ç›®çš„,æ˜¯ä¿è¯è·¯ç”±æ·»åŠ å®Œäº†å†è¿›å…¥é¡µé¢ (å¯ä»¥ç†è§£ä¸ºé‡è¿›ä¸€æ¬¡)
        replace: true // é‡è¿›ä¸€æ¬¡, ä¸ä¿ç•™é‡å¤å†å²
    })
} else {
    next()
}
```

[(7æ¡æ¶ˆæ¯) VUE è·¯ç”±å®ˆå« next() / next({ ...to, replace: true }) / next(â€˜/â€˜) è¯´æ˜_Incimoçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_41912398/article/details/109231418?spm=1001.2014.3001.5506)

#### é€€å‡ºç™»å½•æ—¶é‡ç½®è·¯ç”±

é€€å‡ºåï¼Œå†æ¬¡ç™»é™†ï¼Œå‘ç°èœå•å¼‚å¸¸ ï¼ˆæ§åˆ¶å°æœ‰è¾“å‡ºè¯´è·¯ç”±é‡å¤ï¼‰

![img](https://img-blog.csdnimg.cn/20210706024556428.png)

åŸå› :

è·¯ç”±è®¾ç½®æ˜¯é€šè¿‡`router.addRoutes(filterRoutes)`æ¥æ·»åŠ çš„ï¼Œé€€å‡ºæ—¶ï¼Œå¹¶æ²¡æœ‰æ¸…ç©ºï¼Œå†æ¬¡ç™»é™†ï¼ŒåˆåŠ äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥æœ‰é‡å¤ã€‚

éœ€è¦å°†è·¯ç”±æƒé™é‡ç½® (æ¢å¤é»˜è®¤) å°†æ¥ç™»å½•åå†æ¬¡è¿½åŠ æ‰å¯ä»¥ï¼Œä¸ç„¶çš„è¯ï¼Œå°±ä¼šé‡å¤æ·»åŠ 

åœ¨router/index.jsä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³• è¿™ä¸ªæ–¹æ³•å°†è·¯ç”±é‡æ–°å®ä¾‹åŒ–

```js
// é‡ç½®è·¯ç”±
export function resetRouter() {
    const newRouter = createRouter()
    router.matcher = newRouter.matcher // é‡æ–°è®¾ç½®è·¯ç”±çš„å¯åŒ¹é…è·¯å¾„
}
```

é€€å‡ºçš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³•

```js
import { resetRouter } from '@/router'
// é€€å‡ºçš„actionæ“ä½œ
logout(context) {
    // 1. ç§»é™¤vuexä¸ªäººä¿¡æ¯
    context.commit('removeUserInfo')
    // 2. ç§»é™¤tokenä¿¡æ¯
    context.commit('removeToken')
    // 3. é‡ç½®è·¯ç”±
    resetRouter()
}
```

## axioså…·ä½“å°è£…

```js
// åˆ›å»ºä¸€ä¸ªå®ä¾‹
const service = axios.create({
    baseURL: process.env.VUE_APP_BASE_API, // url = base url + request url
    // withCredentials: true, // å½“è·¨åŸŸè¯·æ±‚æ—¶å‘é€cookie
    timeout: 5000 // request timeout
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(config => {
    if (store.getters.token) {
        // å¦‚æœæºå¸¦token åœ¨å“åº”å¤´è®¾ç½®(ä¸åç«¯å•†é‡)  
        config.headers['token'] = getToken()
    }
    return config
}, error => {
    console.log(error)
    return Promise.reject(error)
})

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
    /**
   * å¦‚æœä½ æƒ³è·å–httpä¿¡æ¯ï¼Œå¦‚è¯·æ±‚å¤´æˆ–çŠ¶æ€
   * å¯ä»¥return  response => response
  */
    /**
   * é€šè¿‡è‡ªå®šä¹‰ä»£ç ç¡®å®šè¯·æ±‚çŠ¶æ€
   * ä¹Ÿå¯ä»¥é€šè¿‡HTTPçŠ¶æ€ç æ¥åˆ¤æ–­çŠ¶æ€
   */
    response => {
        const res = response.data
        // æœåŠ¡å™¨å“åº”å¤±è´¥çš„å›è°ƒ codeçš„å€¼å¯èƒ½æ˜¯200ä¹Ÿå¯èƒ½20000
        if (res.code !== 20000 && res.code !== 200) {
            Message({
                message: res.message || 'Error',
                type: 'error',
                duration: 5 * 1000
            })

            // 50008: éæ³•çš„token; 50012: å·²ç™»å½•çš„å…¶ä»–å®¢æˆ·ç«¯; 50014: tokenè¿‡æœŸ;
            if (res.code === 50008 || res.code === 50012 || res.code === 50014) {
                // é‡æ–°ç™»å½•
                // You have been logged out, you can cancel to stay on this page, or log in again
                MessageBox.confirm('æ‚¨å·²ç™»å‡ºï¼Œæ‚¨å¯ä»¥å–æ¶ˆä»¥ç•™åœ¨æ­¤é¡µé¢ï¼Œæˆ–é‡æ–°ç™»å½•', 'ç¡®è®¤æ³¨é”€', {
                    confirmButtonText: 'é‡æ–°ç™»å½•',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'warning'
                }).then(() => {
                    store.dispatch('user/resetToken').then(() => {
                        location.reload()
                    })
                })
            }
            return Promise.reject(new Error(res.message || 'Error'))
        } else {
            // ç›¸åº”æˆåŠŸçš„å›è°ƒ
            return res
        }
    },
    error => {
        console.log('err' + error) // for debug
        Message({
            message: error.message,
            type: 'error',
            duration: 5 * 1000
        })
        return Promise.reject(error)
    }
)
```

### ç”¨è¿‡fetchå—?fetchå’Œaxiosçš„åŒºåˆ«çŸ¥é“å—?

**1ã€æœ€å¤§çš„ä¸åŒ:**

**æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºFetchæ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œè€ŒAxioséœ€è¦å¼•å…¥Axiosåº“ã€‚**

**2ã€å…¼å®¹æ€§æ–¹é¢**

Axioså¯ä»¥å…¼å®¹IEæµè§ˆå™¨ï¼Œè€Œ**Fetchåœ¨IEæµè§ˆå™¨å’Œä¸€äº›è€ç‰ˆæœ¬æµè§ˆå™¨ä¸Šæ²¡æœ‰å—åˆ°æ”¯æŒ**ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåº“å¯ä»¥è®©è€ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒFetchå³å®ƒå°±æ˜¯whatwg-fetchï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨Fetchï¼Œå¹¶ä¸”ç°åœ¨å¾ˆå¤šç½‘ç«™çš„å¼€å‘éƒ½ä¸ºäº†å‡å°‘æˆæœ¬è€Œé€‰æ‹©ä¸å†å…¼å®¹IEæµè§ˆå™¨ã€‚

**3ã€å“åº”è¶…æ—¶**

Axiosçš„ç›¸åº”è¶…æ—¶è®¾ç½®æ˜¯éå¸¸ç®€å•çš„ï¼Œç›´æ¥è®¾ç½®timeoutå±æ€§å°±å¯ä»¥äº†ï¼Œè€ŒFetchè®¾ç½®èµ·æ¥å°±è¿œæ¯”Axioséº»çƒ¦ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººæ›´å–œæ¬¢Axiosè€Œä¸å¤ªå–œæ¬¢Fetchçš„åŸå› ä¹‹ä¸€ã€‚

**4ã€å¯¹æ•°æ®çš„è½¬æ¢**

Axiosè¿˜æœ‰éå¸¸å¥½çš„ä¸€ç‚¹å°±æ˜¯ä¼šè‡ªåŠ¨å¯¹æ•°æ®è¿›è¡Œè½¬åŒ–ï¼Œè€ŒFetchåˆ™ä¸åŒï¼Œå®ƒéœ€è¦ä½¿ç”¨è€…è¿›è¡Œæ‰‹åŠ¨è½¬åŒ–ã€‚

**5ã€æ‹¦æˆªå™¨**

Fetchæ²¡æœ‰æ‹¦æˆªå™¨åŠŸèƒ½ï¼Œä½†æ˜¯è¦å®ç°è¯¥åŠŸèƒ½å¹¶ä¸éš¾ï¼Œç›´æ¥é‡å†™å…¨å±€Fetchæ–¹æ³•å°±å¯ä»¥åŠåˆ°ã€‚

## å›¾ç‰‡æ‡’åŠ è½½æ‰‹åŠ¨å°è£…

```
æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨IntersectionObserver APIå°è£…v-lazyè‡ªå®šä¹‰æŒ‡ä»¤å®ç°å›¾ç‰‡æ‡’åŠ è½½
```

- é€šè¿‡onscrolläº‹ä»¶**ï¼ˆæ€§èƒ½ä¸å¥½ï¼‰**
- é€šè¿‡intersectionObserver API**ï¼ˆå…¼å®¹æ€§å·®ï¼‰**

onscrolläº‹ä»¶

```
ç»™å›¾ç‰‡å…ƒç´ è®¾ç½®ä¸€ä¸ªsrcå±æ€§å­˜å‚¨é»˜è®¤å›¾ç‰‡ï¼Œå†è®¾ç½®ä¸€ä¸ªdata-srcè‡ªå®šä¹‰å±æ€§å­˜å‚¨çœŸæ­£çš„ç›®æ ‡å›¾ç‰‡ï¼Œé€šè¿‡ç›‘å¬ä¸€ä¸ªscrolläº‹ä»¶ï¼Œå½“å›¾ç‰‡å…ƒç´ å‡ºç°åœ¨å¯è§†åŒºåŸŸï¼Œå°†data-srcèµ‹å€¼ç»™srcã€‚ä½†ç”±äºä¸€ç›´ç›‘å¬scrolläº‹ä»¶ï¼Œä¼šå‡ºç°æ€§èƒ½æŸè€—ï¼Œå¯ä»¥é€šè¿‡é˜²æŠ–å‡½æ•°è¿›è¡Œä¼˜åŒ–
```

```html
<img src="default.jpg"
     data-src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/leancloud-assets/dd45c44ce639350dae9b.jpg~tplv-t2oaga2asx-zoom-crop-mark:1512:1512:1512:851.awebp">
</body>
```

```js
let img = document.querySelector('img')
lazyLoad() // é¡µé¢åŠ è½½å…ˆè°ƒç”¨ä¸€æ¬¡
// ç»‘å®šscrolläº‹ä»¶
window.onscroll = debounce(function lazyLoad() {
    console.log('æ»šåŠ¨äº‹ä»¶è§¦å‘');
    // å¯è§†åŒ–åŒºåŸŸ
    let seeHeight = document.documentElement.clientHeight
    // æ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„ä½ç½®
    let scrollTop = document.documentElement.scrollTop || document.body.scrollTop

    // åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›å…¥å¯è§†åŒº
    if (img.offsetTop < seeHeight + scrollTop) {
        if (img.getAttribute('src') === 'default.jpg') {
            console.log('æ‡’åŠ è½½æˆåŠŸï¼ï¼ï¼')
            // å°†imgçš„data-srcèµ‹å€¼ç»™çœŸæ­£çš„src
            img.src = img.getAttribute('data-src')
        }
    }
}, 1000) // ç»‘å®šscrolläº‹ä»¶



// scrolläº‹ä»¶è§¦å‘é¢‘ç¹ï¼Œéœ€è¿›è¡Œé˜²æŠ–ä¼˜åŒ–
function debounce(fn, delay) {
    let timer = null
    return function () {
        // ä¿å­˜thisæŒ‡å‘å’Œä¼ å…¥å‚æ•°
        let context = this
        let args = arguments
        if (timer) {
            // å¦‚æœæ­¤æ—¶å­˜åœ¨å®šæ—¶å™¨çš„è¯ï¼Œåˆ™å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨é‡æ–°è®°æ—¶
            clearTimeout(timer)
            timer = null
        }
        // è®¾ç½®å®šæ—¶å™¨ï¼Œä½¿äº‹ä»¶é—´éš”æŒ‡å®šäº‹ä»¶åæ‰§è¡Œ
        timer = setTimeout(() => {
            fn.apply(context, args)
        }, delay)
    }
}
}
```

intersectionObserver API

[Vue2 ä¸­è‡ªå®šä¹‰å›¾ç‰‡æ‡’åŠ è½½æŒ‡ä»¤ 2.0 - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7146659891300532232)

```
IntersectionObserver æ˜¯ä¸€ä¸ªæ–°å¢çš„APIï¼Œå¯ä»¥è·å–ç›®æ ‡å…ƒç´ äºç¥–å…ˆå…ƒç´ æˆ–è€…viewportç›¸äº¤æƒ…å†µå˜åŒ–ã€‚é€šè¿‡newä¸€ä¸ª intersectionObserver åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè°ƒç”¨observeæ–¹æ³•å¯¹ç›®æ ‡å…ƒç´ è¿›è¡Œä¸€ä¸ªç›‘å¬ã€‚newçš„æ—¶å€™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰entryå¯¹è±¡çš„æ•°ç»„ï¼Œå¯¹æ•°ç»„è¿›è¡Œéå†ï¼Œå½“ç›®æ ‡entryå‡ºç°åœ¨å¯è§†åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨isintersectingè¿›è¡Œåˆ¤æ–­ï¼Œå†å°†ç›®æ ‡å›¾ç‰‡æ›¿æ¢é»˜è®¤çš„å›¾ç‰‡å¹¶è°ƒç”¨unobserveè¿›è¡Œå–æ¶ˆç›‘å¬ã€‚

åœ¨vueè‡ªå®šä¹‰æŒ‡ä»¤ä¸­ï¼Œä¸»è¦æ˜¯ç”¨äº†ä¸¤ä¸ªé’©å­ï¼Œinsertedå’Œunbindï¼Œinsertedä¸­å›¾ç‰‡å…ƒç´ æ’å…¥åˆ°æ–‡æ¡£æ—¶åˆå§‹åŒ–å¼€å¯ç›‘å¬ï¼Œunbindè§£ç»‘æ—¶å–æ¶ˆç›‘å¬
```

```html
<div id="app">
    <img v-lazy="defaultImg"
         data-src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/leancloud-assets/dd45c44ce639350dae9b.jpg~tplv-t2oaga2asx-zoom-crop-mark:1512:1512:1512:851.awebp">
    <img v-lazy="defaultImg"
         data-src="https://tse1-mm.cn.bing.net/th/id/OIP-C.30Ri-r8Y7dBxlWeaX4o35QHaE2?w=243&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7">
    <img v-lazy="defaultImg"
         data-src="https://tse3-mm.cn.bing.net/th/id/OIP-C.a_2XJOKnYxsnGU-tYazCWwHaF7?w=196&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7">
    <img v-lazy="defaultImg"
         data-src="https://tse4-mm.cn.bing.net/th/id/OIP-C.2IRCeI7lpFjVDkDwqMseBQHaEo?w=277&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7">
</div>
```

```js
new Vue({
    el: '#app',
    data() {
        return {
            defaultImg: 'default.jpg', // é»˜è®¤å›¾ç‰‡
        };
    },
    directives: {
        lazy: {
            inserted(el, binding) {
                const io = new IntersectionObserver((entries) => {
                    console.log(entries);
                    entries.forEach(item => {
                        // åˆ¤æ–­æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ
                        if (item.isIntersecting) {
                            item.target.src = item.target.dataset.src
                            // å–æ¶ˆç›‘å¬
                            io.unobserve(item.target)
                        }
                    })
                })

                // å°†ç»‘å®šçš„å…ƒç´ è®¾ç½®src
                el.src = binding.value
                // å¼€å¯ç›‘å¬å¯¹åº”å…ƒç´ 
                io.observe(el)

            },
            unbind(el, binding, vnode) {
                // å–æ¶ˆç›‘å¬
                io.unobserve(el)
            },
        }
    }
})
```

## è™šæ‹Ÿåˆ—è¡¨

[æ‘¸é±¼ä¸¤å¤©ï¼Œå½»åº•æ‹¿ä¸‹è™šæ‹Ÿæ»šåŠ¨ï¼ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7211088034179366973?searchId=202307181402159253F2A90269DEA1D8FA#heading-10)

æ ¸å¿ƒæ­¥éª¤ï¼š

```html
<div class="scroll-container" ref="scrollContainer" @scroll="handleScroll">
    <div class="content-container" style="{ position: relative}">
        <div class="content-item" style="{ position: absolute, top: 0, left: 0,  transform: `translateY(${(startIndex + index) * itemHeight}px)`}"></div>
        ...
        <div class="content-item"></div>
    </div>
</div>
```

> ç»™å¤–å±‚å®¹å™¨ç»‘å®šä¸€ä¸ªscrolläº‹ä»¶ï¼Œè®¾ç½®å¼€å§‹å’Œç»“æŸçš„ç´¢å¼•å€¼ç”¨äºåœ¨æ»šåŠ¨æ—¶è·å–éœ€è¦æ¸²æŸ“æ•°æ®çš„åŒºé—´ã€‚å†è·å–å½“å‰æ»šåŠ¨ä½ç½®åˆ°é¡¶éƒ¨çš„scrollTopå€¼æ¥è®¡ç®—å¼€å§‹å’Œç»“æŸçš„ç´¢å¼•
>
> ```js
> const scrollTop = scrollContainer.value.scrollTop
> startIndex.value = Math.floor(scrollTop / itemHeight)
> endIndex.value = Math.ceil((scrollTop + viewPortHeight) / itemHeight) - 1
> // endIndex.value = startIndex.value + visibleCount.value
> // visibleCount.value = Math.ceil(viewPortHeight.value / itemHeight.value)
> ```
>
> è·å–åˆ°éœ€è¦æ¸²æŸ“çš„æ•°æ®åŒºé—´ç”¨sliceè¿›è¡Œæˆªå–
>
> ```js
> const renderDataList = ref(dataSource.slice(startIndex.value, endIndex.value + 1))
> ```

## éª¨æ¶å±åŸç†

```
åœ¨æ¨¡æ¿index.htmlä¸­æœ‰ä¸€ä¸ªidä¸ºappçš„divï¼Œvueçš„$mountå®è´¨æ˜¯é€šè¿‡æ›¿æ¢è¿™ä¸ªdivå…ƒç´ 
```

æ–¹æ¡ˆä¸€ï¼šåœ¨`<div id='app'></div>`ä¸­æ·»åŠ éª¨æ¶ï¼Œç¨‹åºæ¸²æŸ“åå°±ç›´æ¥è¿›è¡Œæ›¿æ¢

æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨base64çš„å›¾ç‰‡ä½œä¸ºéª¨æ¶å±ï¼Œå°ç±³å•†åŸçš„ç§»åŠ¨ç«¯é¡µé¢é‡‡ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•

æ–¹æ¡ˆä¸‰ï¼š.vueæ–‡ä»¶

## è·¯ç”±æ‡’åŠ è½½

æ‡’åŠ è½½ç®€å•æ¥è¯´å°±æ˜¯å»¶è¿ŸåŠ è½½æˆ–æŒ‰éœ€åŠ è½½ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™çš„æ—¶å€™è¿›è¡ŒåŠ è½½

```js
function load(component) {
    return () => import(`views/${component}`)
}
```

é€šè¿‡Webpackç¼–è¯‘æ‰“åŒ…åï¼Œä¼šæŠŠæ¯ä¸ªè·¯ç”±ç»„ä»¶çš„ä»£ç åˆ†å‰²æˆä¸€ä¸€ä¸ªjsæ–‡ä»¶ï¼Œåˆå§‹åŒ–æ—¶ä¸ä¼šåŠ è½½è¿™äº›jsæ–‡ä»¶ï¼Œåªå½“æ¿€æ´»è·¯ç”±ç»„ä»¶æ‰ä¼šå»åŠ è½½å¯¹åº”çš„jsæ–‡ä»¶

ä½œç”¨å°±æ˜¯webpackåœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œå¯¹å¼‚æ­¥å¼•å…¥çš„åº“ä»£ç è¿›è¡Œä»£ç åˆ†å‰²æ—¶ï¼ˆéœ€è¦é…ç½®webpackçš„SplitChunkPluginæ’ä»¶ï¼‰ï¼Œä¸ºåˆ†å‰²åçš„ä»£ç å—å–å¾—åå­—

Vueä¸­è¿ç”¨importçš„æ‡’åŠ è½½è¯­å¥ä»¥åŠwebpackçš„é­”æ³•æ³¨é‡Šï¼Œåœ¨é¡¹ç›®è¿›è¡Œwebpackæ‰“åŒ…çš„æ—¶å€™ï¼Œå¯¹ä¸åŒæ¨¡å—è¿›è¡Œä»£ç åˆ†å‰²ï¼Œåœ¨é¦–å±åŠ è½½æ—¶ï¼Œç”¨åˆ°å“ªä¸ªæ¨¡å—å†åŠ è½½å“ªä¸ªæ¨¡å—ï¼Œå®ç°æ‡’åŠ è½½è¿›è¡Œé¡µé¢çš„ä¼˜åŒ–ã€‚

## å‡½æ•°å¼ç»„ä»¶

æ²¡æœ‰ç®¡ç†ä»»ä½•çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰ç›‘å¬ä»»ä½•ä¼ é€’ç»™å®ƒçš„çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ¥å—ä¸€äº› prop çš„å‡½æ•°ã€‚ç®€å•æ¥è¯´æ˜¯ ä¸€ä¸ªæ— çŠ¶æ€å’Œæ— å®ä¾‹çš„ç»„ä»¶

**renderå‡½æ•°çš„ç¬¬äºŒå‚æ•°contextï¼Œé€šè¿‡contextè¿›è¡Œä¸€åˆ‡å‚æ•°ä¼ é€’**

å‡½æ•°å¼ç»„ä»¶åªæ˜¯å‡½æ•°ï¼Œæ¸²æŸ“å¼€é”€å¾ˆä½

```vue
<script>
    export default {
        functional: true, // å‡½æ•°å¼ç»„ä»¶
        props: ["level", "title"],
        // headingç»„ä»¶
        // <heading :level="1" :title="title" icon="cart">{{title}}</heading>
        // <h2 title=""></h2>
        render(h, context) {
            // å­èŠ‚ç‚¹æ•°ç»„
            let children = [];
            // æ²¡æœ‰this,åŒæ ·ä¹Ÿæ²¡æœ‰$slot.default
            // é»˜è®¤æ’æ§½ï¼Œé»˜è®¤å­å…ƒç´ çš„å†™æ³•æœ‰æ‰€æ›´æ”¹
            children = children.concat(context.children);

            const { title, level } = context.props;
            return h(
                "h" + level, // å‚æ•°1ï¼Œtagname
                { attrs: { title } }, // å‚æ•°2ï¼š{ã€‚ã€‚ã€‚}é…ç½®çš„æ•°æ®å¯¹è±¡
                children // è™šæ‹Ÿå­èŠ‚ç‚¹VNodeä¸èƒ½å†ä½¿ç”¨$slot.default å­èŠ‚ç‚¹
            )
        }
    }
</script>

<style lang="scss" scoped>
</style>

```

## CDNä¼˜åŒ–

CDN(content delivery network)å†…å®¹åˆ†å‘ç½‘ç»œï¼Œè®¿é—®æœ€è¿‘æœåŠ¡å™¨ï¼Œä¸»è¦ç”¨äºæ‰˜ç®¡ä¸€äº›webèµ„æºï¼ˆå›¾ç‰‡ã€æ–‡æœ¬å’Œè„šæœ¬ç­‰ï¼‰ï¼Œå¯ä¾›ä¸‹è½½çš„èµ„æºï¼ˆåª’ä½“æ–‡ä»¶ã€è½¯ä»¶ã€æ–‡æ¡£ç­‰ï¼‰ï¼Œåº”ç”¨ç¨‹åºç­‰ã€‚å¯ç”¨CDNåŠ é€Ÿèµ„æºçš„è®¿é—®ã€‚

æ€§èƒ½æ–¹é¢ï¼šå»¶è¿Ÿæ›´ä½ï¼Œå†…å®¹åŠ è½½æ›´å¿«

å®‰å…¨æ–¹é¢ï¼šæœ‰åŠ©äºé˜²å¾¡DDosç­‰ç½‘ç»œæ”»å‡»

### CDNä¸DNSè§£æ

CDNå®é™…ä¸Šæ˜¯ä¸€ä¸ªå°±è¿‘è®¿é—®ï¼Œå°±éœ€è¦ç”¨åˆ°dnsè§£æipåœ°å€è¿›è¡Œä¸€ä¸ªå®šä½ï¼Œè¿™æ ·å°±å¯ä»¥è®¿é—®æœ€è¿‘çš„CDNèŠ‚ç‚¹

**å…·ä½“DNSè§£æè¿‡ç¨‹ï¼š**

```
é¦–å…ˆå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ªDNSè¯·æ±‚ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œæ£€æŸ¥ç¼“å­˜ï¼ˆæµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿå¦‚hostsã€è·¯ç”±å™¨ï¼‰æŸ¥æ‰¾åŸŸåï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å°±è®¿é—®æ ¹åŸŸåæœåŠ¡å™¨ã€‚æ ¹DNSæ”¶åˆ°è¯·æ±‚ï¼Œè¿”å›.com .cnçš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼Œç„¶åç»§ç»­å‘é¡¶çº§åŸŸåæœåŠ¡å™¨å‘è¯·æ±‚ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨åˆè¿”å›æ¬¡çº§åŸŸåæœåŠ¡å™¨ï¼ˆæƒå¨åŸŸåæœåŠ¡å™¨ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°å¯¹åº”çš„ipåœ°å€ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ç¼“å­˜ç»“æœï¼Œè¿”å›ç»™å®¢æˆ·ç«¯
```

**CDNå·¥ä½œåŸç†**

```
DNSè§£æå¾—åˆ°å¯¹åº”çš„ipåœ°å€ï¼Œå‘æœ€è¿‘çš„CDNæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨å‘æµè§ˆå™¨è¿”å›å“åº”æ•°æ®
```

### å…·ä½“CDNåœ¨é¡¹ç›®ä¸­é…ç½®

åœ¨config.jsæ–‡ä»¶ä¸­é€šè¿‡externalsé…ç½®é¡¹è¿›è¡Œcdné…ç½®

é‡Œé¢è®¾ç½®éœ€è¦ç”¨åˆ°çš„cdnçš„åº“æ¯”å¦‚axiosã€el-ui

```js
module.exports = {
    configureWebpack: {
        externals:{
            'vue': 'Vue',
            'element-ui': 'ELEMENT',
            'quill': 'Quill'
        }
    },
}
```

## gzip

gzipå‹ç¼©æ˜¯ä¸€ç§httpè¯·æ±‚ä¼˜åŒ–æ–¹å¼ï¼Œé€šè¿‡å‡å°‘æ–‡ä»¶ä½“ç§¯æ¥æé«˜åŠ è½½é€Ÿåº¦ã€‚htmlã€cssã€jsæ–‡ä»¶ç”šè‡³jsonéƒ½å¯ä»¥ç”¨æ¥å‹ç¼©ï¼Œå¯ä»¥å‡å°60%ä»¥ä¸Šçš„ä½“ç§¯ã€‚å‰ç«¯é…ç½®gzipå‹ç¼©ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨nginxå¼€å¯gzipï¼Œå‡å°ç½‘ç»œä¼ è¾“çš„æµé‡

æ‰§è¡Œå‘½åï¼š`npm i compression-webpack-plugin -D`

```js
const CompressionWebpackPlugin = require('compression-webpack-plugin')

plugins: [
   new CompressionWebpackPlugin()
]
```

## æ€§èƒ½ä¼˜åŒ–

> è·¯ç”±æ‡’åŠ è½½ï¼šå¦‚æœä¸åšå¤„ç†ï¼Œç”¨æˆ·æ‰“å¼€é¦–é¡µæ—¶ï¼Œä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰èµ„æºã€‚åˆ©ç”¨import()åŠ¨æ€å¯¼å…¥ï¼Œwebpackæ‰“åŒ…æ—¶ä¸ºç”Ÿæˆä¸€ä¸ªä¸ªchunkï¼Œåªæœ‰è¢«æ¿€æ´»çš„æ—¶å€™ä½¿ç”¨
>
> ç»„ä»¶æ‡’åŠ è½½
>
> tree-shaking
>
> éª¨æ¶å±ï¼šå¯ä»¥ç¼©çŸ­ç™½å±æ—¶é—´ï¼Œæå‡ç”¨æˆ·æ€§èƒ½ã€‚åŸç†ï¼šé¡¹ç›®åœ¨é¡¹ç›®æ‰“åŒ…æ—¶å†…å®¹æ”¾åˆ°htmlæ–‡ä»¶ä¸­idä¸ºappçš„divé‡Œï¼Œè¿›è¡Œä¸€ä¸ªæ›¿æ¢
>
> é•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
>
> éª¨æ¶å±
>
> Web Worker ä¼˜åŒ–é•¿ä»»åŠ¡
>
> requestAnimationFrame åˆ¶ä½œåŠ¨ç”»ï¼šsetTimeout/setInterval å±äº `JSå¼•æ“`ï¼ŒrequestAnimationFrame å±äº `GUIå¼•æ“`
>
> å›¾ç‰‡ä¼˜åŒ–ï¼šæ‡’åŠ è½½ï¼Œè½¬base64
>
> å‡½æ•°å¼ç»„ä»¶ï¼šå› ä¸ºå‡½æ•°æ˜¯ç»„ä»¶é¡¾åæ€ä¹‰ä»–å°±æ˜¯ä¸ªå‡½æ•°ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸ª`renderå‡½æ•°`ï¼Œä»–å°‘äº†ç»„ä»¶åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œçœå»äº†å¾ˆå¤šåˆå§‹åŒ–è¿‡ç¨‹çš„`å¼€é”€`

```
é¦–å…ˆæ€§èƒ½ä¼˜åŒ–å¯ä»¥åˆ†ä¸ºé¦–å±ä¼˜åŒ–å’Œruntimeè¿è¡Œæ—¶çš„ä¼˜åŒ–ã€‚å¯¹äºé¦–å±ä¼˜åŒ–ï¼Œå¯ä»¥é€šè¿‡å‡å°å…¥å£æ–‡ä»¶ä½“ç§¯ï¼Œæ¯”å¦‚è·¯ç”±æ‡’åŠ è½½ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œç”¨æˆ·æ‰“å¼€é¦–é¡µå°±ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„èµ„æºï¼Œå¯ä»¥åˆ©ç”¨import()åŠ¨æ€å¯¼å…¥ï¼Œwebpackåœ¨æ‰“åŒ…æ—¶å°±ä¼šç”Ÿæˆä¸ºä¸€ä¸ªä¸ªchunkï¼Œåªæœ‰åœ¨è¢«æ¿€æ´»çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ã€‚ç„¶åå¯ä»¥åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œåç«¯è¿”å›èµ„æºçš„æ—¶å€™è®¾ç½®cache-controlï¼Œexpireså­—æ®µï¼Œå‰ç«¯åˆç†çš„åˆ©ç”¨web storageï¼Œå‡½æ•°å¼ç»„ä»¶ï¼Œè¯´ç™½äº†å°±ä¸€ä¸ªrenderå‡½æ•°ï¼Œå°‘äº†ç»„ä»¶åŒ–åˆå§‹çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰è‡ªå·±çš„å®ä¾‹ï¼Œæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œçœå»äº†åˆå§‹åŒ–çš„æ€§èƒ½å¼€é”€ã€‚è¿˜æœ‰åˆ©ç”¨cdnä¼˜åŒ–å˜›ï¼Œå°±æ˜¯å°±è¿‘è®¿é—®å˜›ï¼Œæ ¹æ®ä¸€ä¸ªdnsè§£æipåœ°å€è®¿é—®å°±è¿‘çš„æœåŠ¡å™¨ï¼ŒåŠ é€Ÿèµ„æºè®¿é—®ï¼Œè¿˜æœ‰gzipå‹ç¼©å‡å°‘æ–‡ä»¶ä½“ç§¯ã€‚å›¾ç‰‡çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡canvasè½¬base64ã€å­—ä½“å›¾æ ‡ç­‰
ä»£ç å±‚é¢è¿è¡Œæ—¶çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è¯´ä¸€äº›é˜²æŠ–èŠ‚æµå¯¹äº‹ä»¶çš„ä¼˜åŒ–ã€å‡å°‘é¡µé¢é‡ç»˜é‡æ’ã€v-ifï¼Œv-foré¿å…ä¸€èµ·ä½¿ç”¨(v-forä¼˜å…ˆçº§æ¯”v-ifé«˜ï¼ŒåŒæ—¶ä½œç”¨ä¸€ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡æ¸²æŸ“å…ˆå¾ªç¯å†è¿›è¡Œåˆ¤æ–­ä¼šé€ æˆæ€§èƒ½æ–¹é¢çš„æµªè´¹)ï¼Œé•¿åˆ—è¡¨ä¼˜åŒ–ï¼Œwebworkers(åå°åŠ è½½)
```

## åä¸‡æ¡æ•°æ®å¦‚ä½•æ¸²æŸ“

[ä»€ä¹ˆï¼Ÿåç«¯è¦ä¸€æ¬¡æ€§è¿”å›æˆ‘10ä¸‡æ¡æ•°æ®ï¼ä¸”çœ‹æˆ‘è¿™8ç§æ–¹æ¡ˆæœºæ™ºåº”å¯¹ï¼ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7205101745936416829?searchId=202307181402159253F2A90269DEA1D8FA)

> - ç›´æ¥æ¸²æŸ“
> - ä½¿ç”¨å®šæ—¶å™¨åˆ†ç»„åˆ†æ‰¹ä¸€æ¬¡æ¸²æŸ“ï¼ˆå®šæ—¶åŠ è½½ï¼‰
> - ä½¿ç”¨requestAnimationFrameä»£æ›¿å®šæ—¶å™¨æ¸²æŸ“
> - æ­é…åˆ†é¡µç»„ä»¶ï¼Œåˆ†é¡µå±•ç¤º
> - è¡¨æ ¼æ»šåŠ¨è§¦åº•åŠ è½½
> - è™šæ‹Ÿåˆ—è¡¨
> - å¼€å¯å¤šçº¿ç¨‹ï¼ŒwebWorkeræ“ä½œ

## å‰ç«¯åŸ‹ç‚¹

æ•°æ®é‡‡é›†-æ•°æ®å¤„ç†-æ•°æ®åˆ†æå’ŒæŒ–æ˜ï¼Œå¦‚ç”¨æˆ·åœç•™æ—¶é—´ï¼Œç”¨æˆ·å“ªä¸ªæŒ‰é’®ç‚¹çš„å¤šç­‰

**UVï¼ˆUnique visitorï¼‰**

æ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚è®¿é—®æ‚¨ç½‘ç«™çš„ä¸€å°ç”µè„‘å®¢æˆ·ç«¯ä¸ºä¸€ä¸ªè®¿å®¢ã€‚`00:00-24:00`å†…ç›¸åŒçš„å®¢æˆ·ç«¯åªè¢«è®¡ç®—ä¸€æ¬¡ã€‚ä¸€å¤©å†…åŒä¸ªè®¿å®¢å¤šæ¬¡è®¿é—®ä»…è®¡ç®—ä¸€ä¸ª`UV`ã€‚

**IPï¼ˆInternet Protocolï¼‰**

ç‹¬ç«‹`IP`æ˜¯æŒ‡è®¿é—®è¿‡æŸç«™ç‚¹çš„`IP`æ€»æ•°ï¼Œä»¥ç”¨æˆ·çš„IPåœ°å€ä½œä¸ºç»Ÿè®¡ä¾æ®ã€‚`00:00-24:00`å†…ç›¸åŒ`IP`åœ°å€ä¹‹è¢«è®¡ç®—ä¸€æ¬¡ã€‚

**UVä¸IPåŒºåˆ«**

> å¦‚ï¼šä½ å’Œä½ çš„å®¶äººç”¨å„è‡ªçš„è´¦å·åœ¨åŒä¸€å°ç”µè„‘ä¸Šç™»å½•æ–°æµªå¾®åšï¼Œåˆ™`IP`æ•°+1ï¼Œ`UV`æ•°+2ã€‚ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€å°ç”µè„‘ï¼Œæ‰€ä»¥`IP`ä¸å˜ï¼Œä½†ä½¿ç”¨çš„ä¸åŒè´¦å·ï¼Œæ‰€ä»¥`UV`+2

**PVï¼ˆPage Viewï¼‰**

å³é¡µé¢æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯1æ¬¡å¯¹ç½‘ç«™ä¸­çš„æ¯ä¸ªç½‘é¡µè®¿é—®å‡è¢«è®°å½•1ä¸ª`PV`ã€‚ç”¨æˆ·å¯¹åŒä¸€é¡µé¢çš„å¤šæ¬¡è®¿é—®ï¼Œè®¿é—®é‡ç´¯è®¡ï¼Œç”¨ä»¥è¡¡é‡ç½‘ç«™ç”¨æˆ·è®¿é—®çš„ç½‘é¡µæ•°é‡ã€‚

**VVï¼ˆVisit Viewï¼‰**

ç”¨ä»¥ç»Ÿè®¡æ‰€æœ‰è®¿å®¢1å¤©å†…è®¿é—®ç½‘ç«™çš„æ¬¡æ•°ã€‚å½“è®¿å®¢å®Œæˆæ‰€æœ‰æµè§ˆå¹¶æœ€ç»ˆå…³æ‰è¯¥ç½‘ç«™çš„æ‰€æœ‰é¡µé¢æ—¶ä¾¿å®Œæˆäº†ä¸€æ¬¡è®¿é—®ï¼ŒåŒä¸€è®¿å®¢1å¤©å†…å¯èƒ½æœ‰å¤šæ¬¡è®¿é—®è¡Œä¸ºï¼Œè®¿é—®æ¬¡æ•°ç´¯è®¡ã€‚

**PVä¸VVåŒºåˆ«**

> å¦‚ï¼šä½ ä»Šå¤©10ç‚¹é’Ÿæ‰“å¼€äº†ç™¾åº¦ï¼Œè®¿é—®äº†å®ƒçš„ä¸‰ä¸ªé¡µé¢ï¼›11ç‚¹é’Ÿåˆæ‰“å¼€äº†ç™¾åº¦ï¼Œè®¿é—®äº†å®ƒçš„ä¸¤ä¸ªé¡µé¢ï¼Œåˆ™PVæ•°+5ï¼ŒVVæ•°+2.PVæ˜¯æŒ‡é¡µé¢çš„æµè§ˆæ¬¡æ•°ï¼ŒVVæ˜¯æŒ‡ä½ è®¿é—®ç½‘ç«™çš„æ¬¡æ•°

[å‰ç«¯åŸ‹ç‚¹å®ç°æ–¹æ¡ˆâœ” - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7094146488439144455?searchId=202308091435101458E043407721465387)

[èŠèŠä»¤äººå¤´ç–¼çš„åŸ‹ç‚¹ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7223584687100706853?searchId=20230806112906F1A424FA619E88236573)

[ğŸ”¥é¢è¯•å®˜ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªåŸ‹ç‚¹SDK - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7080797016086806536?searchId=20230806112906F1A424FA619E88236573#comment)

å‰ç«¯åŸ‹ç‚¹å¤§è‡´å¯åˆ†ä¸ºæ•°æ®ç›‘æ§ã€æ€§èƒ½ç›‘æ§ã€é”™è¯¯ç›‘æ§ã€‚å…¶ä¸­æ•°æ®ç›‘æ§åŒ…æ‹¬ç›‘æ§pvä»¥åŠè‡ªå®šä¹‰äº‹ä»¶çš„ç›‘æ§ã€‚æ€§èƒ½ç›‘æ§å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ç»™æˆ‘ä»¬æä¾›çš„performance apiã€‚è€Œé”™è¯¯ç›‘æ§æˆ‘ä»¬å¯ä»¥ç›‘å¬windowå¯¹è±¡çš„erroräº‹ä»¶ä»¥åŠç›‘å¬promiseæ²¡æœ‰catchæƒ…å†µçš„unhandlerejected apiã€‚å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬å¿…é¡»ä½¿ç”¨imgç­‰æ¥è¿›è¡Œè¯·æ±‚ï¼Œå› ä¸ºimgæ ‡ç­¾ä¸ä¼šè·¨åŸŸä¸”å…¼å®¹æ€§è¾ƒå¥½ã€‚æœ€åï¼Œreact/vueå†…éƒ¨æä¾›äº†ä¸€äº›apiå¦‚ComponentDidCatchï¼ˆreactï¼‰/errorCapturedï¼ˆvueï¼‰ç­‰apiæ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨è‡ªå®šä¹‰äº‹ä»¶è¿›è¡Œå‘é€

## Monorepo

> Monorepoæ˜¯ä¸€ç§é¡¹ç›®ä»£ç ç®¡ç†æ–¹å¼ï¼Œå°±æ˜¯è®©å¾ˆå¤šé¡¹ç›®æ”¾åˆ°ä¸€ä¸ªworkspaceä¸‹è¿›è¡Œç®¡ç†ï¼Œè¿™äº›é¡¹ç›®å¯ä»¥**ç›¸äº’ä¾èµ–å’Œè®¿é—®**ï¼Œåˆ©ç”¨pnmpè¿›è¡Œé¡¹ç›®ç®¡ç†é…ç½®workspaceã€‚ä½¿ç”¨äºä¸­å¤§å‹ï¼Œå¤šæ¨¡å—çš„é¡¹ç›®
>
> ä¼˜ç‚¹ï¼š
>
> ä¸€ä¸ªä»“åº“ä¸­å¤šä¸ªç›¸å…³é¡¹ç›®ï¼Œå®¹æ˜“çœ‹åˆ°æ•´ä¸ªä»£ç åº“çš„å˜åŒ–è¶‹åŠ¿ï¼›ç›¸åŒç‰ˆæœ¬ä¾èµ–æå‡åˆ°é¡¶å±‚åªå®‰è£…ä¸€æ¬¡ï¼ŒèŠ‚çœç£ç›˜å†…å­˜ï¼› ä»£ç å¤ç”¨é«˜ï¼Œæ–¹ä¾¿è¿›è¡Œä»£ç é‡æ„ï¼›å¯ä»¥å®ç°ä¸€æ¬¡å‘½ä»¤å®Œæˆæ‰€æœ‰çš„éƒ¨ç½²
>
> ç¼ºç‚¹ï¼š
>
> ä¸€ä¸ªé¡¹ç›®å‡ºé—®é¢˜ï¼Œå¯èƒ½å½±å“æ‰€æœ‰é¡¹ç›®ï¼›ä»£ç ä½“ç§¯å¤šå¤§å‡ ä¸ª Gï¼Œgit cloneæ—¶é—´è¾ƒé•¿

| **åœºæ™¯**   | MultiRepo                                                    | **MonoRepo**                                                 |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ä»£ç å¯è§æ€§ | âœ… ä»£ç éš”ç¦»ï¼Œç ”å‘è€…åªéœ€å…³æ³¨è‡ªå·±è´Ÿè´£çš„ä»“åº“<br/>âŒ åŒ…ç®¡ç†æŒ‰ç…§å„è‡ªowneråˆ’åˆ†ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œéœ€è¦åˆ°ä¾èµ–åŒ…ä¸­è¿›è¡Œåˆ¤æ–­å¹¶è§£å†³ã€‚ | âœ… ä¸€ä¸ªä»“åº“ä¸­å¤šä¸ªç›¸å…³é¡¹ç›®ï¼Œå¾ˆå®¹æ˜“çœ‹åˆ°æ•´ä¸ªä»£ç åº“çš„å˜åŒ–è¶‹åŠ¿ï¼Œæ›´å¥½çš„å›¢é˜Ÿåä½œã€‚<br/>âŒ å¢åŠ äº†éowneræ”¹åŠ¨ä»£ç çš„é£é™© |
| ä¾èµ–ç®¡ç†   | âŒ å¤šä¸ªä»“åº“éƒ½æœ‰è‡ªå·±çš„ node_modulesï¼Œå­˜åœ¨ä¾èµ–é‡å¤å®‰è£…æƒ…å†µï¼Œå ç”¨ç£ç›˜å†…å­˜å¤§ã€‚ | âœ… å¤šé¡¹ç›®ä»£ç éƒ½åœ¨ä¸€ä¸ªä»“åº“ä¸­ï¼Œç›¸åŒç‰ˆæœ¬ä¾èµ–æå‡åˆ°é¡¶å±‚åªå®‰è£…ä¸€æ¬¡ï¼ŒèŠ‚çœç£ç›˜å†…å­˜ï¼Œ |
| ä»£ç æƒé™   | âœ… å„é¡¹ç›®å•ç‹¬ä»“åº“ï¼Œä¸ä¼šå‡ºç°ä»£ç è¢«è¯¯æ”¹çš„æƒ…å†µï¼Œå•ä¸ªé¡¹ç›®å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–é¡¹ç›®ã€‚ | âŒ å¤šä¸ªé¡¹ç›®ä»£ç éƒ½åœ¨ä¸€ä¸ªä»“åº“ä¸­ï¼Œæ²¡æœ‰é¡¹ç›®ç²’åº¦çš„æƒé™ç®¡æ§ï¼Œä¸€ä¸ªé¡¹ç›®å‡ºé—®é¢˜ï¼Œå¯èƒ½å½±å“æ‰€æœ‰é¡¹ç›®ã€‚ |
| å¼€å‘è¿­ä»£   | âœ… ä»“åº“ä½“ç§¯å°ï¼Œæ¨¡å—åˆ’åˆ†æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§å¼ºã€‚<br/> âŒ å¤šä»“åº“æ¥å›åˆ‡æ¢ï¼ˆç¼–è¾‘å™¨åŠå‘½ä»¤è¡Œï¼‰ï¼Œé¡¹ç›®å¤šçš„è¯æ•ˆç‡å¾ˆä½ã€‚å¤šä»“åº“è§å­˜åœ¨ä¾èµ–æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ `npm link`ï¼Œæ“ä½œç¹çã€‚<br/> âŒ ä¾èµ–ç®¡ç†ä¸ä¾¿ï¼Œå¤šä¸ªä¾èµ–å¯èƒ½åœ¨å¤šä¸ªä»“åº“ä¸­å­˜åœ¨ä¸åŒç‰ˆæœ¬ï¼Œé‡å¤å®‰è£…ï¼Œnpm link æ—¶ä¸åŒé¡¹ç›®çš„ä¾èµ–ä¼šå­˜åœ¨å†²çªã€‚ | âœ… å¤šä¸ªé¡¹ç›®éƒ½åœ¨ä¸€ä¸ªä»“åº“ä¸­ï¼Œå¯çœ‹åˆ°ç›¸å…³é¡¹ç›®å…¨è²Œï¼Œç¼–ç éå¸¸æ–¹ä¾¿ã€‚<br/> âœ… ä»£ç å¤ç”¨é«˜ï¼Œæ–¹ä¾¿è¿›è¡Œä»£ç é‡æ„ã€‚<br/> âŒ å¤šé¡¹ç›®åœ¨ä¸€ä¸ªä»“åº“ä¸­ï¼Œä»£ç ä½“ç§¯å¤šå¤§å‡ ä¸ª Gï¼Œ`git clone`æ—¶é—´è¾ƒé•¿ã€‚<br/> âœ… ä¾èµ–è°ƒè¯•æ–¹ä¾¿ï¼Œä¾èµ–åŒ…è¿­ä»£åœºæ™¯ä¸‹ï¼Œå€ŸåŠ©å·¥å…·è‡ªåŠ¨ npm linkï¼Œç›´æ¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ä¾èµ–ï¼Œç®€åŒ–äº†æ“ä½œæµç¨‹ã€‚ |
| å·¥ç¨‹é…ç½®   | âŒ å„é¡¹ç›®æ„å»ºã€æ‰“åŒ…ã€ä»£ç æ ¡éªŒéƒ½å„è‡ªç»´æŠ¤ï¼Œä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´ä»£ç å·®å¼‚æˆ–æ„å»ºå·®å¼‚ã€‚ | âœ… å¤šé¡¹ç›®åœ¨ä¸€ä¸ªä»“åº“ï¼Œå·¥ç¨‹é…ç½®ä¸€è‡´ï¼Œä»£ç è´¨é‡æ ‡å‡†åŠé£æ ¼ä¹Ÿå¾ˆå®¹æ˜“ä¸€è‡´ã€‚ |
| æ„å»ºéƒ¨ç½²   | âŒ å¤šä¸ªé¡¹ç›®é—´å­˜åœ¨ä¾èµ–ï¼Œéƒ¨ç½²æ—¶éœ€è¦æ‰‹åŠ¨åˆ°ä¸åŒçš„ä»“åº“æ ¹æ®å…ˆåé¡ºåºå»ä¿®æ”¹ç‰ˆæœ¬åŠè¿›è¡Œéƒ¨ç½²ï¼Œæ“ä½œç¹çæ•ˆç‡ä½ã€‚ | âœ… æ„å»ºæ€§ Monorepo å·¥å…·å¯ä»¥é…ç½®ä¾èµ–é¡¹ç›®çš„æ„å»ºä¼˜å…ˆçº§ï¼Œå¯ä»¥å®ç°ä¸€æ¬¡å‘½ä»¤å®Œæˆæ‰€æœ‰çš„éƒ¨ç½²ã€‚ |

### æ„å»ºMonorepoçš„æ–¹å¼

- pnpm workspaceæ„å»ºMonorepoç¼ºç‚¹

  1. éœ€è¦æ‰‹åŠ¨æå‡å…¬å…±ä¾èµ–ã€‚

  2. éœ€è¦æ‰‹åŠ¨æŒ‡å®šä»»åŠ¡(dev,build)æ‰§è¡Œï¼Œä»»åŠ¡ä¸æ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼Œå½±å“æ„å»ºé€Ÿåº¦ã€‚

  3. ä¸æ”¯æŒè‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶ï¼Œéœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå®˜æ–¹æ¨èä¸¤ä¸ªå·¥å…·[changesets](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchangesets%2Fchangesets)ã€[Rush](https://link.juejin.cn?target=https%3A%2F%2Frushjs.io%2F)ã€‚

  4. æ²¡æœ‰é€šç”¨çš„è„šæ‰‹æ¶æ¨¡æ¿ã€‚

  5. ä¸æ”¯æŒç¼“å­˜ã€‚

  6. ä¸æ”¯æŒä¾èµ–åˆ†æã€‚

- Lerna
- Turborepo...

## npmï¼Œyarnï¼ŒpnpmåŒ…ç‰ˆæœ¬ç®¡ç†å·¥å…·

yarnç›¸å¯¹npmçš„ä¼˜åŠ¿

> npm install ä¼šæŒ‰é¡ºåºå®‰è£…package.jsonï¼Œyrané‡‡ç”¨å¹¶è¡Œå®‰è£…ï¼Œæå‡é€Ÿåº¦
>
> npmæ¯æ¬¡å®‰è£…éƒ½è¦é‡æ–°å®‰è£…ï¼Œyarné‡‡ç”¨äº†ç¼“å­˜çš„æ–¹å¼ï¼ŒåŒæ ·å†…å®¹ä¸ä¼šé‡å¤å®‰è£…

pnpmè§£å†³yranã€npmçš„ç—›ç‚¹ï¼š

> npm/yarné‡‡ç”¨æ‰å¹³åŒ–å®‰è£…ï¼Œä¾èµ–æ ‘è€—æ—¶å¤æ‚ï¼Œå¯èƒ½å­˜åœ¨é‡å¤å®‰è£…ï¼ˆä¸€ä¸ªé¡¹ç›®æ ‘ä¸­ï¼ŒåŒä¸€ä¸ªåŒ…å¤šæ¬¡è¢«å®‰è£…ï¼‰ã€å¹½çµä¾èµ–ï¼ˆé¡¹ç›®çš„ä¾èµ–åˆ—è¡¨ä¸­å‡ºç°ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨ä»£ç ä¸­è¢«ä½¿ç”¨åˆ°çš„ä¾èµ–åŒ…ï¼‰ã€ä¾èµ–åµŒå¥—ï¼Œyarnè™½ç„¶æ˜¯å¹¶è¡Œå®‰è£…ä½†å’Œnpmä¸€æ ·ï¼Œå¦‚æœæœ‰100ä¸ªé¡¹ç›®åˆ™ä¼šä¸‹è½½100ä¸ªnode_modulesï¼Œå ç”¨å·¨å¤§çš„ç£ç›˜ç©ºé—´
>
> pnpmæ˜¯ä¸€ç§æŒ‰éæ‰å¹³åŒ–ï¼ˆä¸€ä¸ªåº“å¯èƒ½è¿˜ä¾èµ–å…¶ä»–åº“ï¼Œå…¶ä»–åº“å¯ä»¥è½¯é“¾æ¥åˆ°å…¶ä»–åœ°æ–¹ï¼Œç„¶ååˆå¯ä»¥ç¡¬é“¾æ¥åˆ°storeé‡Œï¼‰ç»“åˆè½¯ç¡¬é“¾æ¥çš„æ–¹å¼ï¼Œä¼šå…±äº«åŒä¸€ä¸ªæœ¬åœ°å¤§ä»“åº“ï¼Œå¹¶ä¸”å¹¶è¡Œå®‰è£…ï¼Œå¤§å¤§æå‡å®‰è£…é€Ÿåº¦è€Œä¸”èŠ‚çœç£ç›˜å¼€é”€
>
> ![image-20230808204410847](C:\Users\Cauchy\AppData\Roaming\Typora\typora-user-images\image-20230808204410847.png)

å¹½çµä¾èµ–çš„äº§ç”Ÿï¼šnpm/yarn å®‰è£…ä¾èµ–æ—¶ï¼Œå­˜åœ¨ä¾èµ–æå‡ï¼ŒæŸä¸ªé¡¹ç›®ä½¿ç”¨çš„ä¾èµ–ï¼Œå¹¶æ²¡æœ‰åœ¨å…¶ package.json ä¸­å£°æ˜ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™ç§ç°è±¡ç§°ä¹‹ä¸º â€œå¹½çµä¾èµ–â€ï¼›éšç€é¡¹ç›®è¿­ä»£ï¼Œè¿™ä¸ªä¾èµ–ä¸å†è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨ï¼Œä¸å†è¢«å®‰è£…ï¼Œä½¿ç”¨å¹½çµä¾èµ–çš„é¡¹ç›®ï¼Œä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°ä¾èµ–è€ŒæŠ¥é”™ã€‚

## è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥åŒºåˆ«

> è½¯é“¾æ¥æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå®ƒæ˜¯æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ç±»ä¼¼äºä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œé€šè¿‡è½¯é“¾æ¥å¯ä»¥è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œé“¾æ¥æ–‡ä»¶æˆ–ç›®å½•
>
> ç¡¬é“¾æ¥æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¤šä¸ªæ–‡ä»¶æ¡ç›®æŒ‡å‘åŒä¸€ä¸ªæ•°æ®å—çš„é“¾æ¥ã€‚ç›¸å½“äºå¤šä¸ªæ–‡ä»¶å…±äº«åŒä¸€ä»½å†…å­˜ç©ºé—´ï¼ŒæŒ‡å‘åŒä¸€ä¸ªæ•°æ®æ¨¡å—

## å¾®å‰ç«¯

> å¾®å‰ç«¯å€Ÿé‰´å¾®æœåŠ¡çš„ç†å¿µï¼Œå°†ä¸€ä¸ªåºå¤§çš„åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çµæ´»çš„å°å‹åº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹è¿è¡Œï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œè¿˜å¯ä»¥éšæ„ç»„åˆï¼Œè¿™æ ·å°±é™ä½äº†è€¦åˆåº¦ï¼Œä»è€Œæ›´åŠ çµæ´»ã€‚
>
> å¾®å‰ç«¯å®ç°æ–¹æ¡ˆï¼š
>
> 1. iframeåŠ è½½å­åº”ç”¨ï¼Œé€šè¿‡postMessageè¿›è¡Œé€šä¿¡ï¼Œç®€å•ã€éš”ç¦»ã€å®‰å…¨ï¼Œä½†domå‰²è£‚æ„Ÿä¸¥é‡ï¼›å¸ƒå±€çº¦æŸï¼›ä¸åˆ©äºseoï¼Œä¼šå½“æˆ2ä¸ªé¡µé¢ï¼›åˆ·æ–° iframe url çŠ¶æ€ä¸¢å¤±ã€åé€€å‰è¿›æŒ‰é’®æ— æ³•ä½¿ç”¨
> 2. web component
>
>    ```ts
>    class myWebComponent extends HTMLElement{
>        constructor(){
>            super()
>            // shawdow dom æ ·å¼éš”ç¦»
>            let dom = this.attachShadow({mode:"open"}) //openå¤–éƒ¨å¯ä»¥è®¿é—®åˆ° closedåˆ™æ‹¿ä¸åˆ°
>            let template = document.querySelector('#id') as HTMLTemplateElement
>    
>            dom.appendChild(template.content.cloneNode(true))
>    
>            console.log(this.getAttr('url'))
>        }
>        // è·å–å‚æ•°
>        pravite getAttr(attr:string){
>            return this.getAttribute(attr)
>        }
>    
>        //ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨è§¦å‘æœ‰ä¸œè¥¿æ’å…¥
>        connectedCallback () {
>            console.log('ç±»ä¼¼äºvue çš„mounted');
>        }
>        //ç”Ÿå‘½å‘¨æœŸå¸è½½
>        disconnectedCallback () {
>            console.log('ç±»ä¼¼äºvue çš„destory');
>        }
>        //è·Ÿwatchç±»ä¼¼
>        attributeChangedCallback (name:any, oldVal:any, newVal:any) {
>            console.log('è·Ÿvue çš„watch ç±»ä¼¼ æœ‰å±æ€§å‘ç”Ÿå˜åŒ–è‡ªåŠ¨è§¦å‘');
>        }
>    }
>    window.customElements.define('my-web-component',myWebComponent) // æŒ‚è½½å®Œæˆ
>    
>    /* ç›´æ¥åœ¨htmlä¸­ä½¿ç”¨
>        <my-web-component url="xxx"></my-web-component>
>        
>    	<template id="id">
>    		<style>
>    			...
>    		</style>
>    	</template>
>    */
>    ```
>
> 3. qiankun
> 4. æ— ç•Œ
> 5. EMP(åŸºäº webpack 5 module federation æ¨¡å—è”é‚¦æŠ€æœ¯) 

**æ¨¡å—è”é‚¦**

> å»ä¸­å¿ƒåŒ–æŠ€æœ¯ï¼Œå®ƒå¯ä»¥è®©å¤šä¸ªç‹¬ç«‹æ„å»ºçš„åº”ç”¨ä¹‹é—´ï¼ŒåŠ¨æ€çš„è°ƒç”¨å½¼æ­¤çš„æ¨¡å—ã€‚è·Ÿwebpack5å¼ºè€¦åˆçš„ï¼Œæ˜¯åŸºäºwebpack5å†…ç½®ModuleFederationPluginæ’ä»¶
>
> æœ¬è´¨æ˜¯é‡‡å–çš„CDNçš„æ–¹å¼
>
> ç¼ºç‚¹ï¼šå±€é™æ€§ï¼Œä¸webpack5å¼ºè€¦åˆï¼›æ²¡æœ‰æ ·å¼éš”ç¦»ï¼Œé€ æˆæ ·å¼æ±¡æŸ“ï¼›å¯¹runtime`è¿è¡Œæ—¶åšäº†å¤§é‡æ”¹é€ ï¼Œåœ¨è¿è¡Œæ—¶è¦åšçš„äº‹æƒ…ä¹Ÿå› æ­¤å¢åŠ å¾ˆå¤šï¼Œä¼šå¯¹æˆ‘ä»¬é¡µé¢çš„è¿è¡Œæ—¶æ€§èƒ½é€ æˆä¸€å®šçš„è´Ÿé¢å½±å“ï¼›ç”±äºæ˜¯è¿è¡Œæ—¶å…±äº«ï¼Œé‚£ä¹ˆè¿œç¨‹æ¨¡å—çš„ç‰ˆæœ¬ç®¡ç†ä¹Ÿæ˜¯åº”è¯¥å»è€ƒè™‘çš„é—®é¢˜
>
> ä¸qiankunçš„åŒºåˆ«
>
> 1. qiankunæ˜¯ä¸€ç§å¾®å‰ç«¯æŠ€æœ¯ï¼Œè€Œæ¨¡å—è”é‚¦æ˜¯ä¸€ç§æ¨¡å—åŒ–å¼€å‘æŠ€æœ¯ã€‚
> 2. qiankunä»¥å•é¡µåº”ç”¨ä¸ºæ ¸å¿ƒï¼Œå¯ä»¥å°†å¤šä¸ªå­åº”ç”¨ä½œä¸ºç‹¬ç«‹çš„SPAè¿è¡Œï¼›
>    è€Œæ¨¡å—è”é‚¦åˆ™ä»¥å¤šä¸ªæ¨¡å—ä½œä¸ºæ ¸å¿ƒï¼Œå¯ä»¥å°†å¤šä¸ªå­åº”ç”¨ä½œä¸ºå¤šä¸ªæ¨¡å—è¿è¡Œã€‚
> 3. qiankunå¯ä»¥å®ç°è·¯ç”±ç»Ÿä¸€ï¼Œæ•°æ®å…±äº«ï¼›
>    è€Œæ¨¡å—è”é‚¦åˆ™å¯ä»¥å®ç°ä»£ç ç»Ÿä¸€ï¼Œæ•°æ®éš”ç¦»ã€‚
> 4. qiankunçš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°è·¨åº”ç”¨çš„è·¯ç”±è·³è½¬å’Œæ•°æ®å…±äº«ï¼›
>    è€Œæ¨¡å—è”é‚¦çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°ä»£ç çš„å¤ç”¨å’Œæ•°æ®çš„éš”ç¦»ã€‚

## å¾®å‰ç«¯åŸç†ï¼Œå®ç°jséš”ç¦»ã€æ ·å¼éš”ç¦»

jséš”ç¦»ï¼šå¿«ç…§æ²™ç®±ï¼ŒProxy ä»£ç†æ²™ç®±

æ ·å¼éš”ç¦»ï¼šå¢åŠ ä¸åŒå‰ç¼€ï¼›shadow dom

### shadow dom

> ç›´è¯‘æ˜¯å½±å­domï¼Œå¯ä»¥ç†è§£ä¸ºdomä¸­çš„domï¼Œå¯ä»¥ä¸ºwebç»„ä»¶ä¸­çš„domå’Œcssæä¾›å°è£…ï¼Œshadow domæ ‘ä¸å­˜åœ¨ä¸»domæ ‘ä¸Šï¼Œä¼šå’Œä¸»domçš„æ ‘ä¿æŒåˆ†ç¦»ï¼Œç‹¬ç«‹çš„ï¼Œå†…å¤–éƒ¨ä¸ä¼šç›¸äº’å½±å“ã€‚

### å¯ä»¥ç”¨ä¸€ä¸ªæŠ€æœ¯æ ˆå†™ï¼Œä¸ºä»€ä¹ˆæ‹†å¼€ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆå†™ï¼Œç»´æŠ¤ä¸éº»çƒ¦å—

> å°½ç®¡æ‹†åˆ†æˆä¸åŒæŠ€æœ¯æ ˆçš„å­åº”ç”¨å¯èƒ½ä¼šå¢åŠ ç»´æŠ¤çš„å¤æ‚æ€§ï¼Œä½†å¾®å‰ç«¯å¸¦æ¥æ›´å¥½çš„ä»£ç éš”ç¦»ã€ç‹¬ç«‹éƒ¨ç½²å’Œå¼€å‘é€Ÿåº¦ç­‰ã€‚é€‰æ‹©æ˜¯å¦é‡‡ç”¨ä¸åŒæŠ€æœ¯æ ˆæ¥å¼€å‘å­åº”ç”¨ï¼Œåº”è¯¥åŸºäºé¡¹ç›®çš„éœ€æ±‚ã€å›¢é˜Ÿçš„æŠ€èƒ½å’Œèµ„æºç­‰æ¥æƒè¡¡ï¼Œå¯¹äºæŸäº›å›¢é˜Ÿå’Œé¡¹ç›®ï¼Œå•ä¸€æŠ€æœ¯æ ˆå¯èƒ½æ›´é€‚åˆï¼Œè€Œå¯¹äºå…¶ä»–é¡¹ç›®ï¼Œæ‹†åˆ†æˆå¤šä¸ªæŠ€æœ¯æ ˆçš„å­åº”ç”¨å¯èƒ½èƒ½å¤Ÿæä¾›æ›´å¤§çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚

## Husky

> Husky æ˜¯ä¸€ä¸ªç”¨äº Git é’©å­çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨å¼€å‘è€…æ‰§è¡Œ Git å‘½ä»¤æ—¶è§¦å‘ä¸€äº›è‡ªå®šä¹‰çš„è„šæœ¬ã€‚Git é’©å­å…è®¸å¼€å‘è€…åœ¨ç‰¹å®šçš„ Git äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆä¾‹å¦‚æäº¤ä»£ç ã€æ¨é€åˆ†æ”¯ç­‰ï¼‰ï¼Œæ‰§è¡Œé¢„å®šä¹‰çš„æ“ä½œï¼Œä»¥ä¾¿åœ¨å¼€å‘è¿‡ç¨‹ä¸­å®æ–½ä¸€äº›è§„èŒƒã€æ£€æŸ¥æˆ–è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚
>
> - åœ¨æäº¤ä»£ç å‰è¿è¡Œä»£ç æ ¼å¼åŒ–è„šæœ¬ï¼Œç¡®ä¿ä»£ç éµå¾ªä¸€è‡´çš„æ ¼å¼è§„èŒƒã€‚
> - åœ¨æ¨é€åˆ†æ”¯å‰è¿è¡Œé™æ€ä»£ç åˆ†æå·¥å…·ï¼Œæ£€æŸ¥æ½œåœ¨çš„é—®é¢˜ã€‚

## å¤§æ–‡ä»¶ä¸Šä¼ 

> å®¢æˆ·ç«¯ï¼š
>
> æ ¸å¿ƒæ˜¯åˆ©ç”¨ Blob.prototype.slice æ–¹æ³•ï¼Œå’Œæ•°ç»„çš„ slice æ–¹æ³•ç›¸ä¼¼ï¼Œæ–‡ä»¶çš„ slice æ–¹æ³•å¯ä»¥è¿”å›åŸæ–‡ä»¶çš„æŸä¸ªåˆ‡ç‰‡ã€‚é¢„å…ˆå®šä¹‰å¥½å•ä¸ªåˆ‡ç‰‡å¤§å°ï¼Œå°†æ–‡ä»¶åˆ‡åˆ†ä¸ºä¸€ä¸ªä¸ªåˆ‡ç‰‡ï¼Œå€ŸåŠ©httpå¯å¹¶å‘æ€§åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶åˆ‡ç‰‡ï¼ˆç”±äºæ˜¯å¹¶å‘ï¼Œç»™æ¯ä¸ªåˆ‡ç‰‡è®°å½•é¡ºåºï¼‰
>
> æ–­ç‚¹ç»­ä¼ ï¼šåœ¨äºå‰ç«¯/æœåŠ¡ç«¯éœ€è¦è®°ä½å·²ä¸Šä¼ çš„åˆ‡ç‰‡ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸Šä¼ å°±å¯ä»¥è·³è¿‡ä¹‹å‰å·²ä¸Šä¼ çš„éƒ¨åˆ†ã€‚ä¸¤ç§æ–¹æ³•å‰ç«¯ä½¿ç”¨ localStorage è®°å½•å·²ä¸Šä¼ çš„åˆ‡ç‰‡ hashæˆ–è€…æœåŠ¡ç«¯ä¿å­˜å·²ä¸Šä¼ çš„åˆ‡ç‰‡ hashï¼Œå‰ç«¯æ¯æ¬¡ä¸Šä¼ å‰å‘æœåŠ¡ç«¯è·å–å·²ä¸Šä¼ çš„åˆ‡ç‰‡ï¼ˆä¿å­˜å·²ä¸Šä¼ çš„åˆ‡ç‰‡ hashï¼Œå‰ç«¯æ¯æ¬¡ä¸Šä¼ å‰å‘æœåŠ¡ç«¯è·å–å·²ä¸Šä¼ çš„åˆ‡ç‰‡ï¼‰
>
> æ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œéƒ½å¿…é¡»è¦ç”Ÿæˆæ–‡ä»¶å’Œåˆ‡ç‰‡çš„ hashï¼Œæ–‡ä»¶åä¸€æ—¦ä¿®æ”¹å°±å¤±å»äº†æ•ˆæœï¼Œè€Œäº‹å®ä¸Šåªè¦æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œhash å°±ä¸åº”è¯¥å˜åŒ–ã€‚æ‰€ä»¥åº”è¯¥æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆhashï¼Œä½¿ç”¨spark-md5è®¡ç®—ã€‚å¦å¤–ä¸Šä¼ è¶…å¤§æ–‡ä»¶ï¼Œè®¡ç®—æ–‡ä»¶hashéå¸¸è€—æ—¶å¼•èµ·UIé˜»å¡ï¼Œå¯¼è‡´é¡µé¢å‡æ­»ï¼Œä½¿ç”¨web workeråœ¨workerçº¿ç¨‹è®¡ç®—ï¼Œä¸å½±å“ä¸»çº¿ç¨‹ã€‚
>
> æ‰€è°“æ–‡ä»¶å¦™ä¼ ï¼Œå³æœåŠ¡ç«¯å·²ç»å­˜åœ¨ä¸Šä¼ çš„èµ„æºï¼Œç”¨æˆ·ä¸Šä¼ ç›´æ¥æç¤ºä¸Šä¼ æˆåŠŸï¼Œç»™ç”¨æˆ·çœ‹çš„éšœçœ¼æ³•ï¼Œå®è´¨æ ¹æœ¬æ²¡æœ‰ä¸Šä¼ ã€‚åœ¨æ­£å¼å‘é€ä¸Šä¼ è¯·æ±‚ä¹‹å‰å‘é€ä¸€ä¸ªç±»ä¼¼é¢„æ£€çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯fse.existsSync(filePath)åˆ¤æ–­æ˜¯å¦å­˜åœ¨
>
> æš‚åœä¸Šä¼ ï¼ŒXMLHttpRequest abort()æ–¹æ³•ï¼Œfetch AbortControllerï¼Œaxiosé€šfetch(cancle tokenå·²å¼ƒç”¨)
>
> æ¢å¤ä¸Šä¼ ï¼Œåœ¨é¢„æ£€è¯·æ±‚ä¸­ï¼ŒæœåŠ¡å™¨fse.readdir(filePath)æ‰¾å‡ºå·²ä¸Šä¼ çš„åˆ‡ç‰‡å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¯ç©ºæ•°ç»„ï¼Œå®¢æˆ·ç«¯å¯¹åˆ‡ç‰‡æ•°ç»„è¿›è¡Œè¿‡æ»¤ï¼Œé‡æ–°ä¸Šä¼ 
>
> å¹¶å‘æ§åˆ¶ï¼Œåˆ‡ç‰‡è¿‡å¤§ï¼Œä¸€æ¬¡å‘å‡ ç™¾ä¸ªhttpè¯·æ±‚ï¼ŒTCPå»ºç«‹çš„è¿‡ç¨‹å°±æŠŠæµè§ˆå™¨å¼„æ­»



> æœåŠ¡ç«¯ï¼š
>
> æ¥æ”¶åˆ°æ‰€æœ‰åˆ‡ç‰‡ååˆå¹¶æ‰€æœ‰åˆ‡ç‰‡ï¼Œä¸¤ä¸ªæ–¹æ³•æ¥æ”¶åˆ°è¿™ä¸ªæ•°é‡çš„åˆ‡ç‰‡æ—¶è‡ªåŠ¨åˆå¹¶ï¼Œæˆ–è€…é¢å¤–å‘é€ä¸€ä¸ªè¯·æ±‚ä¸»åŠ¨é€šçŸ¥æœåŠ¡ç«¯åˆ‡ç‰‡åˆå¹¶ã€‚åˆå¹¶çš„æ–¹æ³•é€šè¿‡Nodeçš„è¯»å†™æµï¼ˆreadStream/writeStreamï¼‰ï¼Œå°†æ‰€æœ‰åˆ‡ç‰‡çš„æµä¼ è¾“åˆ°æœ€ç»ˆæ–‡ä»¶çš„æµé‡Œ
>
>  fse.createWriteStream åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå¯å†™æµæ–‡ä»¶åå°±æ˜¯ä¸Šä¼ æ—¶çš„æ–‡ä»¶å,éšåéå†æ•´ä¸ªåˆ‡ç‰‡æ–‡ä»¶å¤¹ï¼Œå°†åˆ‡ç‰‡é€šè¿‡ fse.createReadStream åˆ›å»ºå¯è¯»æµï¼Œä¼ è¾“åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­

## web worker

åœ¨ HTML é¡µé¢ä¸­ï¼Œå¦‚æœåœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œé¡µé¢çš„çŠ¶æ€æ˜¯ä¸å¯å“åº”çš„ï¼Œç›´åˆ°è„šæœ¬æ‰§è¡Œå®Œæˆåï¼Œé¡µé¢æ‰å˜æˆå¯å“åº”ã€‚web worker æ˜¯è¿è¡Œåœ¨åå°çš„ jsï¼Œç‹¬ç«‹äºå…¶ä»–è„šæœ¬ï¼Œä¸ä¼šå½±å“é¡µé¢çš„æ€§èƒ½ã€‚ å¹¶ä¸”é€šè¿‡ postMessage å°†ç»“æœå›ä¼ åˆ°ä¸»çº¿ç¨‹ã€‚è¿™æ ·åœ¨è¿›è¡Œå¤æ‚æ“ä½œçš„æ—¶å€™ï¼Œå°±ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹äº†ã€‚ä¸å…è®¸è®¿é—®domï¼ŒimportScripts`å‡½æ•°ç”¨äºå¯¼å…¥

## uniappè·¯ç”±å°è£…

```js
// ç™½åå•
const whiteList = [
    '/', // æ³¨æ„å…¥å£é¡µå¿…é¡»ç›´æ¥å†™ '/'
    { pattern: /^\/pages\/list.*/ }, // æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
    '/pages/index/index',
    '/pages/family/family',
    { pattern: /^\/pages\/login\/*/ }
]

export default async function () {
    const list = ['navigateTo', 'redirectTo', 'reLaunch', 'switchTab']
    // ç”¨éå†çš„æ–¹å¼åˆ†åˆ«ä¸º,uni.navigateTo,uni.redirectTo,uni.reLaunch,uni.switchTabè¿™4ä¸ªè·¯ç”±æ–¹æ³•æ·»åŠ æ‹¦æˆªå™¨
    list.forEach(item => {
        uni.addInterceptor(item, {
            invoke(e) {
                // è·å–è¦è·³è½¬çš„é¡µé¢è·¯å¾„ï¼ˆurlå»æ‰"?"å’Œ"?"åçš„å‚æ•°ï¼‰
                const url = e.url.split('?')[0]
                console.log('url', url)

                uni.setStorageSync('startTime', Date.now())

                // åˆ¤æ–­å½“å‰çª—å£æ˜¯ç™½åå•ï¼Œå¦‚æœæ˜¯åˆ™ä¸é‡å®šå‘è·¯ç”±
                let pass
                if (whiteList) {
                    pass = whiteList.some((item) => {
                        if (typeof (item) === 'object' && item.pattern) {
                            return item.pattern.test(url)
                        }
                        return url === item
                    })
                }
                // ä¸æ˜¯ç™½åå•å¹¶ä¸”æ²¡æœ‰token
                if (!pass) {
                    uni.showToast({
                        title: 'è¯·å…ˆç™»å½•',
                        icon: 'none'
                    })
                    uni.navigateTo({
                        url: "/pages/login/login"
                    })
                    return false
                }
                return e
            },
            fail(err) { // å¤±è´¥å›è°ƒæ‹¦æˆª
                console.log(err)
            }
        })
    })
}
```

uniapp ä½¿ç”¨uni.socketConnect å³ä½¿åœ¨çº¿èŠå¤©

```js
// socket.js å°è£… uni.socketConnect
// å¿ƒè·³é—´éš”ã€é‡è¿websocketé—´éš”ï¼Œ5ç§’
const interval = 5000
// é‡è¿æœ€å¤§æ¬¡æ•°
const maxReconnectMaxTime = 5

export default class WS {
    constructor(options) {
        // é…ç½®
        this.options = options
        // WSå®ä¾‹
        this.socketTask = null

        // æ­£å¸¸å…³é—­
        this.normalCloseFlag = false
        // é‡æ–°è¿æ¥æ¬¡æ•°
        this.reconnectTime = 1
        // é‡æ–°è¿æ¥Timer
        this.reconnectTimer = null
        // å¿ƒè·³Timer
        this.heartTimer = null

        // å‘èµ·è¿æ¥
        this.initWS()

        // å…³é—­WS
        this.close = () => {
            // æ­£å¸¸å…³é—­çŠ¶æ€
            this.normalCloseFlag = true
            // å…³é—­websocket
            this.socketTask.close()
            // å…³é—­å¿ƒè·³å®šæ—¶å™¨
            clearInterval(this.heartTimer)
            // å…³é—­é‡è¿å®šæ—¶å™¨
            clearTimeout(this.reconnectTimer)
        }
    }

    initWS() {
        // this.options.data è¿æ¥websocketæ‰€éœ€å‚æ•°
        const url = 'ws://' + this.options.data.userId
        this.socketTask = uni.connectSocket({ url, success() { } })
        // ç›‘å¬WS
        this.watchWS()
    }

    watchWS() {
        // ç›‘å¬ WebSocket è¿æ¥æ‰“å¼€äº‹ä»¶
        this.socketTask.onOpen(() => {
            console.log('websocketè¿æ¥æˆåŠŸï¼')
            // è¿æ¥æˆåŠŸ
            this.options.onConnected()
            // é‡ç½®è¿æ¥æ¬¡æ•°
            this.reconnectTime = 1
            // å‘é€å¿ƒè·³
            // this.onHeartBeat()
            // ç›‘å¬æ¶ˆæ¯
            this.onMessage()
            // å…³é—­Toast
            uni.hideLoading()
        })

        // ç›‘å¬websocket é”™è¯¯
        this.socketTask.onError(() => {
            // å…³é—­å¹¶é‡è¿
            this.socketTask.close()
        })

        // ç›‘å¬ WebSocket è¿æ¥å…³é—­äº‹ä»¶
        this.socketTask.onClose((res) => {
            // è¿æ¥é”™è¯¯ï¼Œå‘èµ·é‡è¿æ¥
            if (!this.normalCloseFlag) {
                this.onDisconnected(res)
            }
        })
    }

    // ç›‘å¬æ¶ˆæ¯
    onMessage() {
        // ç›‘å¬websocket æ”¶åˆ°æ¶ˆæ¯
        this.socketTask.onMessage((res) => {
            //æ”¶åˆ°æ¶ˆæ¯
            if (res.data && JSON.parse(res.data).type !== 1) {
                console.log('æ¥æ”¶äº†æ¶ˆæ¯',JSON.parse(res.data).message)
                this.options.onMessage(JSON.parse(res.data))
            } 
            // else {
            //   console.log('æœªç›‘å¬åˆ°æ¶ˆæ¯ï¼šåŸå› ï¼š', JSON.stringify(res))
            // }
        })
    }

    // æ–­å¼€è¿æ¥
    onDisconnected(res) {
        console.log('websocketæ–­å¼€è¿æ¥ï¼ŒåŸå› ï¼š', JSON.stringify(res))
        // å…³é—­å¿ƒè·³
        clearInterval(this.heartTimer)
        // å…¨å±€Toastæç¤ºï¼Œé˜²æ­¢ç”¨æˆ·ç»§ç»­å‘é€
        uni.showLoading({ title: 'æ¶ˆæ¯æ”¶å–ä¸­â€¦' })
        // å°è¯•é‡æ–°è¿æ¥
        this.onReconnect()
    }

    // æ–­çº¿é‡è¿
    onReconnect() {
        clearTimeout(this.reconnectTimer)
        if (this.reconnectTime < maxReconnectMaxTime) {
            this.reconnectTimer = setTimeout(() => {
                console.log(`ç¬¬ã€${this.reconnectTime}ã€‘æ¬¡é‡æ–°è¿æ¥ä¸­â€¦â€¦`)
                this.initWS()
                this.reconnectTime++
            }, interval)
        } else {
            uni.showModal({
                title: 'æ¸©é¦¨æç¤º',
                content: 'æœåŠ¡å™¨å¼€å°å·®å•¦~è¯·è¿”å›èŠå¤©åˆ—è¡¨é‡è¯•',
                showCancel: false,
                confirmText: 'æˆ‘çŸ¥é“äº†',
                success: () => {
                    uni.navigateBack()
                }
            })
        }
    }

    /** @å¿ƒè·³ **/
    onHeartBeat() {
        this.heartTimer = setInterval(() => {
            this.socketTask.send({
                data: `heartï¼š${this.options.data.userId}`,
                success() {
                    console.log('å¿ƒè·³å‘é€æˆåŠŸï¼')
                }
            })
        }, interval)
    }
}
```

```ts
// server
import WebSocket from "ws";

// åˆ›å»º5121ç«¯å£
const wss = new WebSocket.Server({ port: 5121 }, () => {
    console.log('socketæœåŠ¡å¯åŠ¨5121')
})
const state = {
    HEART: 1,
    MESSAGE: 2
}
// ç›‘å¬å®¢æˆ·ç«¯è¿æ¥
wss.on('connection', (socket) => {
    console.log(socket.on, 'å®¢æˆ·ç«¯è¿æ¥æˆåŠŸä¸ªæ•°ï¼š', wss.clients.size)
    // ç›‘å¬æ¶ˆæ¯
    socket.on('message', (e) => {
        // å•å‘
        // socket.send(JSON.stringify({
        //   type: state.MESSAGE,
        //   message: e.toString()
        // }))

        // wss.clientsç”¨äºè®°å½•è¿æ¥wsæœåŠ¡ç«¯çš„å®¢æˆ·ç«¯ä¸ªæ•° ä¸€ä¸ªSetç»“æ„
        // ç”¨äºç¾¤å‘æ¶ˆæ¯
        wss.clients.forEach(item => {
            item.send(JSON.stringify({
                type: state.MESSAGE,
                message: e.toString()
            }))
        })
    })

    // socketé•¿æ—¶é—´ä¸ä½¿ç”¨ï¼Œé‡åˆ°ç½‘ç»œæ³¢åŠ¨ã€å¼±ç½‘æ¨¡å¼å¯èƒ½ä¼šæ–­å¼€
    // å¿ƒè·³æ£€æµ‹ è¿›è¡Œä¿æŠ¤æœºåˆ¶
    let heartInterval: any = null
    heartInterval = setInterval(() => {
        // ç­‰äºOPEN æ‰ä¼šå‘é€å¿ƒè·³
        if (socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type: state.HEART, message: 'å¿ƒè·³æ£€æµ‹' }))
        } else {
            clearInterval(heartInterval)
        }
    }, 5000)
})
```

## viteæ’ä»¶ c-markdow

åŸºäºmarkdown-itåº“å¯¹markdownæ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå…¶æ¬¡ï¼Œéœ€è¦è¯†åˆ«ä»£ç ä¸­çš„markdownæ ‡ç­¾ï¼Œå¹¶è¯»å–æ ‡ç­¾ä¸­æŒ‡å®šçš„markdownæ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨æ­£åˆ™åŠ ä¸Šnodeçš„fsæ¨¡å—åšåˆ°ï¼Œè¿˜æœ‰viteçš„é’©å­å‡½æ•°transformï¼ˆè½¬æ¢ï¼Œç±»ä¼¼webpackçš„loaderï¼‰ã€handleHotUpdateï¼ˆçƒ­é‡è½½ï¼‰

å¯¹évueæ–‡ä»¶ã€æœªä½¿ç”¨c-markdownæ ‡ç­¾çš„vueæ–‡ä»¶è¿›è¡Œè¿‡æ»¤

1. åŒ¹é…vueæ–‡ä»¶ä¸­çš„æ‰€æœ‰ c-markdownæ ‡ç­¾
2. åŠ è½½å¯¹åº”çš„markdownæ–‡ä»¶å†…å®¹ï¼Œå°†markdownæ–‡æœ¬è½¬æ¢ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„htmlæ–‡æœ¬
3. å°†markdownæ ‡ç­¾æ›¿æ¢æˆhtmlæ–‡æœ¬ï¼Œå¼•å…¥styleæ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶å†…å®¹

```ts
handleHotUpdate(ctx: HmrContext) {
    const { file, server, modules } = ctx
    // è¿‡æ»¤é md æ–‡ä»¶
    if (path.extname(file) !== '.md') return
    // æ‰¾åˆ°å¼•å…¥è¯¥ md æ–‡ä»¶çš„ vue æ–‡ä»¶
    const relationId = mdRelationMap.get(file) as string
    // æ‰¾åˆ°è¯¥ vue æ–‡ä»¶çš„ moduleNode
    const relationModule = [...server.moduleGraph.getModulesByFile(relationId)!][0]
    // å‘é€ websocket æ¶ˆæ¯ï¼Œè¿›è¡Œå•æ–‡ä»¶çƒ­é‡è½½
    server.ws.send({
        type: 'update',
        updates: [
            {
                type: 'js-update',
                path: relationModule.file!,
                acceptedPath: relationModule.file!,
                timestamp: new Date().getTime()
            }
        ]
    })
    // æŒ‡å®šéœ€è¦é‡æ–°ç¼–è¯‘çš„æ¨¡å—
    return [...modules, relationModule]
}
```

## è‡ªåˆ¶è„šæ‰‹æ¶

commanderæ§åˆ¶å°æ§åˆ¶å·¥å…·

inquireræ˜¯å‘½ä»¤è¡Œä¸ç”¨æˆ·å±•å¼€äº¤äº’å·¥å…·

downloadGitRepoä¸‹è½½æ¨¡æ¿çš„åº“

> æ–‡ä»¶è¦†ç›–é€»è¾‘ï¼Œå¦‚æœå­˜åœ¨ç›¸åŒæ–‡ä»¶åæ–‡ä»¶ç›®å½•ï¼Œæ˜¯å¦é…ç½®-få‰ç½®è¦†ç›–ï¼Œå¦‚æœé…ç½®äº†ç›´æ¥åˆ é™¤åŸæœ‰æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰é…ç½®è¿›è¡Œè¯¢é—®æ˜¯å¦é‡å†™ï¼Œé‡å†™åˆ™åˆ é™¤åŸæœ‰æ–‡ä»¶ï¼Œç»§ç»­åç»­æ“ä½œ

é—®é¢˜ï¼šnode axios é€‰æ‹©å¿½è§†SSLï¼Œå®¢æˆ·ç«¯æ²¡æ³•ç¡®è®¤æœåŠ¡ç«¯çš„TLSè¯ä¹¦

```js
const https = require("https")
const axios = require('axios')
// åœ¨ axios è¯·æ±‚æ—¶ï¼Œé€‰æ‹©æ€§å¿½ç•¥ SSL
const agent = new https.Agent({
    rejectUnauthorized: false
})

async function getUserRepo() {
    return axios.get("https://api.github.com/users/Cauchy03/repos", {
        httpsAgent: agent
    })
}
```

## è‡ªå®šä¹‰æ°´å°

[Vue3 å®ç°ç½‘é¡µèƒŒæ™¯æ°´å°åŠŸèƒ½ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7126734249561948174)

åœ¨åŸæœ‰çš„ç½‘é¡µä¸Šé™„ä¸Šä¸€ä¸ª DIV å±‚ï¼Œå°†å®ƒè®¾ç½®ç»å¯¹å®šä½é“ºæ»¡æ•´ä¸ªçª—å£ï¼Œç„¶å z-index å€¼å°½é‡å¾€å¤§äº†è®¾ï¼Œä¿è¯è®©æ°´å°å±‚å¤„äºå½“å‰ç½‘é¡µæ‰€æœ‰å…ƒç´ çš„ä¸Šé¢ï¼Œåˆä¸å½±å“å½“å‰ç½‘é¡µçš„æ“ä½œ

åˆ©ç”¨canvasåˆ›å»ºå…·ä½“çš„æ°´å°ç”Ÿæˆbase64ç»™è¿™ä¸ªdiv

## è‡ªå®šä¹‰äºŒç»´ç 

[å‰ç«¯ç”ŸæˆäºŒç»´ç å’Œæ¡å½¢ç å®Œæ•´æ–¹æ¡ˆï¼ˆé™„é—®é¢˜å¤„ç†æ–¹æ¡ˆï¼‰ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7020452677809078308?searchId=20230809190419D074928247836C6F17EF#)

åˆ©ç”¨qrcodejs2åº“ï¼ˆæŠ¥é”™ä½¿ç”¨qrcodejs2-fixï¼‰ï¼Œ

```ts
import QRCode from 'qrcodejs2-fix'
const useQRCode = (el: any) => {
    let text = 'è‡ªå®šä¹‰äºŒç»´ç å†…å®¹';
    new QRCode(el, {
        text: text,
        width: 128,
        height: 128,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H,
    })
}
export default useQRCode
```

## è‡ªå®šä¹‰å…¨å±

[å…¨å±è§£å†³æ–¹æ¡ˆï¼šåŸç”Ÿã€screenfullã€useFullscreenï¼Œæˆ‘è¯¥ç”¨å“ªä¸ªï¼Ÿ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7109268961161642021#)

```ts
const useFullScreen = () => {
  // DOMå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå…¨å±æ¨¡å¼
  let full = document.fullscreenElement
  // åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒå…¨å±
  console.log(document.fullscreenEnabled)
  if (!full) {
    // æ–‡æ¡£æ ¹èŠ‚ç‚¹çš„requestFullscreenæ–¹æ³•ç›´æ¥å®ç°å…¨å±
    document.documentElement.requestFullscreen()
  } else {
    // é€€å‡ºå…¨å±
    document.exitFullscreen()
  }
  return full
}
export default useFullScreen
```

## æš—å¤œæ¨¡å¼

åˆ©ç”¨Element Plus 

```js
// æ ¹å…ƒç´ 
document.documentElement.className = 'dark'
```

```ts
import { ref, watchEffect } from "vue"
import { getActiveThemeName, setActiveThemeName } from "@/utils/cache/localStorage"

const DEFAULT_THEME_NAME = "normal"
type DefaultThemeNameType = typeof DEFAULT_THEME_NAME

/** æ³¨å†Œçš„ä¸»é¢˜åç§°, å…¶ä¸­ DefaultThemeNameType æ˜¯å¿…å¡«çš„ */
export type ThemeName = DefaultThemeNameType | "dark" | "dark-blue"

interface IThemeList {
  title: string
  name: ThemeName
}

/** ä¸»é¢˜åˆ—è¡¨ */
const themeList: IThemeList[] = [
  {
    title: "é»˜è®¤",
    name: DEFAULT_THEME_NAME
  },{
    title: "é»‘æš—",
    name: "dark"
  },{
    title: "æ·±è“",
    name: "dark-blue"
  }]

/** æ­£åœ¨åº”ç”¨çš„ä¸»é¢˜åç§° */
const activeThemeName = ref<ThemeName>(getActiveThemeName() || DEFAULT_THEME_NAME)

const setTheme = (value: ThemeName) => {
  activeThemeName.value = value
}

/** åœ¨ html æ ¹å…ƒç´ ä¸ŠæŒ‚è½½ class */
const setHtmlClassName = (value: ThemeName) => {
  document.documentElement.className = value
}

const initTheme = () => {
  watchEffect(() => {
    const value = activeThemeName.value
    setHtmlClassName(value)
    setActiveThemeName(value)
  })
}

/** ä¸»é¢˜ hook */
export function useTheme() {
  return { themeList, activeThemeName, initTheme, setTheme }
}
```

